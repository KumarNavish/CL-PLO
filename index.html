<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CL-PLO Spine | Stable Transformer Updates for Portfolio Decisions</title>
    <link rel="stylesheet" href="./coreline.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" />
  </head>
  <body>
    <header class="executive" id="top">
      <div class="shell">
        <article class="hero-insight" aria-label="High-signal decision summary">
          <p class="hero-kicker">CL-PLO Decision Spine</p>
          <h1>In deployed transformer portfolios, the updater is the risk control surface.</h1>

          <div class="hero-grid">
            <article class="hero-mini">
              <p class="hero-mini-title">Problem</p>
              <p>Drift-only LLM adaptation overfits calm flow and erodes stress behavior exactly when capital is fragile.</p>
            </article>
            <article class="hero-mini">
              <p class="hero-mini-title">Controlled Variable</p>
              <p>Backbone, optimizer, and risk limits stay fixed. Only the adapter update operator is swapped.</p>
            </article>
            <article class="hero-mini">
              <p class="hero-mini-title">Decision Claim</p>
              <p>With identical data and limits, replay + projection keeps stress memory and improves release safety.</p>
            </article>
          </div>

          <div class="hero-method-row" aria-label="Three strategy one-line summaries">
            <p><span>A</span>Naive: fastest fit, no memory guard.</p>
            <p><span>B</span>Replay: memory pressure, no hard feasibility gate.</p>
            <p><span>C</span>Hybrid: replay plus projected feasible step.</p>
          </div>

          <div class="hero-result">
            <p class="hero-signal">
              <strong>Default signal:</strong> hybrid keeps stress retention and drawdown control without freezing allocation response.
            </p>
            <article class="hero-proof" aria-label="One-screen deployment check">
              <h3>One-screen gate</h3>
              <div class="proof-row">
                <span>Naive</span>
                <span class="proof-metric">stress retention low</span>
              </div>
              <div class="proof-row">
                <span>Replay</span>
                <span class="proof-metric">retention improves, control partial</span>
              </div>
              <div class="proof-row highlight">
                <span>Hybrid</span>
                <span class="proof-metric">retention + feasible-step control</span>
              </div>
              <p class="proof-note">Use Quick, Default, Stress+ below and check if this ordering stays stable.</p>
            </article>
          </div>
        </article>
      </div>
    </header>

    <main class="shell flow">
      <section class="section" id="strategies">
        <h2>1. Three Strategy Mechanisms</h2>
        <div class="pipeline-legend" aria-label="pipeline role legend">
          <span><i class="swatch data"></i>Data stream</span>
          <span><i class="swatch memory"></i>Anchor memory</span>
          <span><i class="swatch update"></i>Update operator</span>
          <span><i class="swatch decision"></i>Decision layer</span>
        </div>

        <div class="strategy-grid">
          <article class="strategy-card">
            <header>
              <p class="method-tag">A · Baseline</p>
              <h3>Naive Online Update</h3>
            </header>
            <div class="pipeline-layout">
              <figure class="pipeline-figure">
                <img class="pipeline-image" src="./assets/diagrams/strategy-naive.svg" alt="Naive pipeline: drift stream updates adapter with no anchor memory protection" loading="lazy" />
              </figure>

              <aside class="pipeline-equation">
                <p class="math-tag prior">Prior work · Eq A</p>
                <div class="math-block compact">
                  \[
                  \theta_{t+1}=\theta_t-\eta_t g_{d,t}
                  \]
                </div>
                <p class="math-meaning"><strong>Use:</strong> fastest adaptation, no stress-memory guard.</p>
              </aside>
            </div>
          </article>

          <article class="strategy-card">
            <header>
              <p class="method-tag">B · Baseline</p>
              <h3>Replay-Regularized</h3>
            </header>
            <div class="pipeline-layout">
              <figure class="pipeline-figure">
                <img class="pipeline-image" src="./assets/diagrams/strategy-replay.svg" alt="Replay pipeline: anchor memory replay mixed into adapter updates without hard projection constraint" loading="lazy" />
              </figure>

              <aside class="pipeline-equation">
                <p class="math-tag prior">Prior work · Eq B</p>
                <div class="math-block compact">
                  \[
                  \theta_{t+1}=\theta_t-\eta_t\left(g_{d,t}+\beta_t g_{a,t}\right)
                  \]
                </div>
                <p class="math-meaning"><strong>Use:</strong> replay reduces forgetting, but conflicting steps can pass.</p>
              </aside>
            </div>
          </article>

          <article class="strategy-card">
            <header>
              <p class="method-tag proposed">C · Proposed</p>
              <h3>Replay + Projection Gate</h3>
            </header>
            <div class="pipeline-layout">
              <figure class="pipeline-figure">
                <img class="pipeline-image" src="./assets/diagrams/strategy-projection.svg" alt="Projection-gated pipeline: replay memory with hard projection gate before decision update" loading="lazy" />
              </figure>

              <aside class="pipeline-equation">
                <p class="math-tag proposed">Proposed here · Eq C</p>
                <div class="math-block compact">
                  \[
                  \tilde g_t=\Pi_{\mathcal{H}_t}(g_{d,t}),
                  \qquad
                  \theta_{t+1}=\theta_t-\eta_t\left(\tilde g_t+\beta_t g_{a,t}\right)
                  \]
                </div>
                <p class="math-meaning"><strong>Use:</strong> every drift step is clipped to anchor-safe geometry before allocation updates.</p>
              </aside>
            </div>
          </article>
        </div>
      </section>

      <section class="section" id="objects">
        <h2>2. Concrete Anchors and Projection</h2>

        <figure class="anchor-board" aria-label="Concrete anchor fixture board">
          <img src="./assets/diagrams/anchor-fixture-board.svg" alt="Financial anchor fixtures shown as regime timeline windows, stress slices on price paths, and distribution-shift signatures" loading="lazy" />
          <figcaption>Anchor set: replayable stress fixtures (regime windows, stress slices, shift signatures) used at each update.</figcaption>
        </figure>

        <div class="projection-wrap">
          <figure class="projection-figure" aria-label="Risk-budget constrained projection">
            <img class="projection-image" src="./assets/diagrams/projection-geometry.svg" alt="Exposure-space projection: raw portfolio update, risk-budget feasible region, and projected feasible update" loading="lazy" />
          </figure>

          <aside class="projection-math-card" aria-label="Projection equation">
            <p class="math-tag proposed">Proposed here</p>
            <div class="math-block projection-math">
              \[
              g_{\mathrm{proj}}
              =
              \arg\min_{g}\lVert g-g_{\mathrm{raw}}\rVert_2^2
              \quad\text{s.t.}\quad
              \langle g,a_t\rangle \ge 0
              \]
            </div>
            <p class="math-meaning"><strong>Use:</strong> keep learning, but clip the step to the nearest move that satisfies the risk budget.</p>
          </aside>
        </div>

        <p class="object-note">Anchors are stress cases the desk keeps. Projection clips updates before they change allocations.</p>
      </section>

      <section class="section" id="math">
        <h2>3. Bounded Math (Prior vs Proposed)</h2>

        <div class="math-grid">
          <article class="math-card">
            <p class="math-tag prior">Prior work</p>
            <h3>Constrained portfolio decision</h3>
            <div class="math-block">
              \[
              \begin{aligned}
              w_t^\star
              &=\arg\max_{w\in\mathcal{W}}
              \Big(
              \mu_t^\top w
              -\frac{\gamma}{2}w^\top\Sigma_t w
              -\lambda_{\mathrm{tc}}\lVert w-w_{t-1}\rVert_1
              \Big)
              \end{aligned}
              \]
            </div>
            <p class="math-meaning"><strong>Use:</strong> map forecasts to tradable weights under fixed risk and turnover limits.</p>
          </article>

          <article class="math-card">
            <p class="math-tag prior">Prior work</p>
            <h3>Replay-regularized adapter update</h3>
            <div class="math-block">
              \[
              \begin{aligned}
              \theta_{t+1}
              &=\theta_t-\eta_t\nabla_\theta
              \Big(
              \mathcal{L}_{\mathrm{drift},t}(\theta_t)
              +\beta_t\,\mathcal{L}_{\mathrm{anchor},t}(\theta_t)
              \Big)
              \end{aligned}
              \]
            </div>
            <p class="math-meaning"><strong>Use:</strong> adapt to current drift while replaying stress anchors.</p>
          </article>

          <article class="math-card">
            <p class="math-tag proposed">Proposed here</p>
            <h3>Projected safe adapter update</h3>
            <div class="math-block">
              \[
              \begin{aligned}
              \tilde g_t
              &=\arg\min_v\lVert v-g_{d,t}\rVert_2^2\\
              \text{s.t.}\quad
              \langle v,g_{a,t}\rangle &\ge -\varepsilon_t\\
              \theta_{t+1}
              &=\theta_t-\eta_t\left(\tilde g_t+\beta_t g_{a,t}\right)
              \end{aligned}
              \]
            </div>
            <p class="math-meaning"><strong>Use:</strong> apply the closest drift step that keeps anchor-memory safety.</p>
          </article>
        </div>
      </section>

      <section class="section" id="workspace" aria-label="Interactive validation workspace">
        <h2>4. Deployment Decision Dashboard</h2>

        <div class="experiment-layout">
          <aside class="control-panel">
            <article class="protocol-board">
              <h3>Modes</h3>
              <div class="preset-row mode-row">
                <button id="apply-quick" data-preset="quick_check" class="btn btn-ghost" type="button">Quick</button>
                <button id="apply-proposal" data-preset="proposal_like" class="btn btn-ghost" type="button">Default</button>
                <button id="apply-stress" data-preset="stress_heavy" class="btn btn-ghost" type="button">Stress+</button>
              </div>
              <p id="mode-readout" class="mode-readout"></p>
            </article>

            <div class="control-stack">
              <article class="focus-panel" aria-label="Strategy focus selector">
                <h3>Strategy</h3>
                <div class="focus-grid">
                  <button id="focus-all" data-focus="all" class="focus-btn active" type="button">All</button>
                  <button id="focus-naive" data-focus="naive" class="focus-btn" type="button">Naive</button>
                  <button id="focus-anchor" data-focus="anchor" class="focus-btn" type="button">Replay</button>
                  <button id="focus-proj" data-focus="anchor_proj" class="focus-btn" type="button">Hybrid</button>
                </div>
              </article>

              <article class="component-panel" aria-label="Constraint toggle interface">
                <h3>Constraint</h3>
                <label class="switch-row" for="toggle-anchor">
                  <span>Anchor fixtures</span>
                  <input id="toggle-anchor" type="checkbox" checked />
                </label>
                <label class="switch-row" for="toggle-projection">
                  <span>Projection gate</span>
                  <input id="toggle-projection" type="checkbox" checked />
                </label>
                <label class="view-row" for="compare-view">
                  <span>Comparison view</span>
                  <select id="compare-view">
                    <option value="all">All strategies</option>
                    <option value="pair">Selected vs naive</option>
                  </select>
                </label>
                <p id="component-readout" class="mode-readout">Anchors ON, projection ON: hybrid control path.</p>
              </article>

              <details class="advanced-panel">
                <summary>Advanced knobs</summary>
                <form id="config-form" class="knob-grid">
                  <label>
                    Anchor weight
                    <input name="anchorBeta" type="number" step="0.01" />
                  </label>
                  <label>
                    LoRA rank
                    <input name="loraRank" type="number" step="1" />
                  </label>
                  <label>
                    Stress frequency
                    <input name="pStress" type="number" step="0.01" />
                  </label>
                  <label>
                    Update steps
                    <input name="steps" type="number" step="1" />
                  </label>
                  <label>
                    Seed
                    <input name="seed" type="number" step="1" />
                  </label>
                </form>
              </details>

              <div class="action-row">
                <button id="run-demo" class="btn btn-primary" type="button">Run Demo</button>
                <button id="reset-form" class="btn btn-ghost" type="button">Reset</button>
              </div>
            </div>

            <div class="run-status">
              <p id="status-line">Ready. Run the selected mode.</p>
              <div class="progress-track"><div id="progress-fill"></div></div>
            </div>
          </aside>

          <div class="results-panel">
            <article id="decision-card" class="decision-card"></article>

            <div id="impact-kpis" class="kpi-row"></div>
            <div id="mode-scorecard" class="mode-scorecard"></div>

            <div class="plot-stack">
              <article class="chart-card">
                <h3>Q1. Which updater survives regime stress while compounding?</h3>
                <p class="plot-caption">All strategies run on the same path with the same frictions.<br />The deploy candidate keeps capital intact in stress blocks and still compounds in calm blocks.</p>
                <canvas id="pnl-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="pnl-reading"></p>
              </article>

              <article class="chart-card">
                <h3>Q2. How much damage is taken, and how fast is recovery?</h3>
                <p class="plot-caption">Drawdown depth and recovery horizon under identical shocks.<br />Better control means shallower losses and faster repair.</p>
                <canvas id="drawdown-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="drawdown-reading"></p>
              </article>

              <article class="chart-card">
                <h3>Q3. Stability vs responsiveness: does allocation adapt without churn?</h3>
                <p class="plot-caption">Solid line: risky allocation. Dashed line: turnover pressure.<br />Strong policies de-risk in stress without churn in calm flow.</p>
                <canvas id="allocation-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="allocation-reading"></p>
              </article>

              <article class="chart-card">
                <h3>Q4. Do risk-adjusted returns hold across regime buckets?</h3>
                <p class="plot-caption">Annualized Sharpe by regime bucket (calm, volatile, stress, shift).<br />Robust strategies hold quality in stress and shifts, not only in aggregate.</p>
                <canvas id="regime-risk-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="regime-risk-reading"></p>
              </article>

              <article class="chart-card chart-card-wide">
                <h3>Q5. What portfolios do these updaters actually hold?</h3>
                <p class="plot-caption">Representative risky/cash sleeves in calm vs stress, with drawdown and recovery context.<br />This is the policy view: compare strategies as decision-makers, not as loss minimizers.</p>
                <canvas id="portfolio-state-chart" class="chart-canvas chart-canvas-short"></canvas>
                <p class="chart-reading" id="portfolio-state-reading"></p>
              </article>
            </div>

            <article class="table-wrap">
              <h3>Deployment Scoreboard</h3>
              <p class="table-guide">Score = stress retention + drawdown control + regime Sharpe + turnover discipline.</p>
              <table id="method-table" class="method-table"></table>
            </article>
          </div>
        </div>
      </section>

      <section class="section" id="takeaway-section">
        <h2>5. Deploy Path</h2>

        <figure class="synthesis-diagram" aria-label="End to end deployment pathway">
          <div class="syn-node">LLM stream</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node">Anchor fixture</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node proposed">Projection-gated update</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node">Fixed optimizer</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node">Release decision</div>
        </figure>

        <article id="takeaway" class="takeaway"></article>
      </section>
    </main>

    <footer class="footer">
      <div class="shell footer-inner">
        <a href="#top" class="inline-link">Back to top</a>
      </div>
    </footer>

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>
    <script>
      window.addEventListener("load", () => {
        if (!window.renderMathInElement) {
          return;
        }
        window.renderMathInElement(document.body, {
          delimiters: [
            { left: "\\[", right: "\\]", display: true },
            { left: "\\(", right: "\\)", display: false },
          ],
          throwOnError: false,
          strict: "ignore",
        });
      });
    </script>
    <script type="module" src="./src/main.js"></script>
  </body>
</html>
