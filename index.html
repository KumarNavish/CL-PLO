<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CL-PLO Spine | Decision-Oriented Continual Update Demo</title>
    <link rel="stylesheet" href="./coreline.css" />
  </head>
  <body>
    <header class="hero" id="top">
      <div class="shell">
        <p class="eyebrow">Continual Learning x Portfolio Optimization</p>
        <h1>Choose the update policy that adapts to drift without forgetting stress behavior.</h1>
        <p class="lead">
          This artifact is a single deployment decision flow: understand the three update systems, run them on the
          same market stream, and promote or reject with evidence.
        </p>
        <div class="hero-actions">
          <a class="btn btn-primary" href="#strategies">See Strategy Pipelines</a>
          <a class="btn btn-ghost" href="#workspace">Run Validation</a>
          <a class="btn btn-ghost" href="#math">Check Math</a>
        </div>
      </div>
    </header>

    <main class="shell">
      <section class="section" id="problem">
        <h2>1. Problem Framing</h2>
        <p class="section-intro">
          In production, the portfolio optimizer is mostly fixed. What changes day to day is the updater that adjusts
          model parameters under regime drift. The risk is clear: adapt too fast and you lose stress memory; adapt too
          slowly and you miss new structure.
        </p>

        <div class="context-grid">
          <article>
            <h3>System reality</h3>
            <p>Same optimizer stack, same risk rules, same turnover controls.</p>
          </article>
          <article>
            <h3>Failure mode</h3>
            <p>Catastrophic forgetting of stress behavior after prolonged drift updates.</p>
          </article>
          <article>
            <h3>Decision objective</h3>
            <p>Maximize adaptation while keeping stress-memory degradation bounded.</p>
          </article>
        </div>

        <article class="bridge-map">
          <h3>Operational Bridge: CL to Portfolio Practice</h3>
          <div class="bridge-row">
            <div class="bridge-left">Drift stream \(\mathcal{D}^{\mathrm{drift}}_t\)</div>
            <div class="bridge-arrow">↔</div>
            <div class="bridge-right">Current regime flow feeding live signals</div>
          </div>
          <div class="bridge-row">
            <div class="bridge-left">Anchor memory \(\mathcal{D}^{\mathrm{anchor}}_t\)</div>
            <div class="bridge-arrow">↔</div>
            <div class="bridge-right">Stress scenarios and historical risk episodes</div>
          </div>
          <div class="bridge-row">
            <div class="bridge-left">Interference control \(\langle g_{d,t}, g_{a,t}\rangle \ge -\varepsilon_t\)</div>
            <div class="bridge-arrow">↔</div>
            <div class="bridge-right">Pre-trade risk gate before model-state promotion</div>
          </div>
        </article>
      </section>

      <section class="section" id="strategies">
        <h2>2. Strategy Pipelines</h2>
        <p class="section-intro">
          All three strategies use the same backbone and optimizer interface. They differ only in what they protect
          during updates.
        </p>

        <article class="strategy-card">
          <header>
            <p class="method-tag">Established baseline</p>
            <h3>Strategy A: Naive online update</h3>
            <p class="strategy-claim">Best adaptation speed, no explicit memory protection.</p>
          </header>

          <div class="pipeline-diagram">
            <div class="pipe-node source">
              <h4>Input</h4>
              <p>Drift batch \(\mathcal{D}^{\mathrm{drift}}_t\)</p>
            </div>
            <div class="pipe-arrow">→</div>
            <div class="pipe-node off">
              <h4>Anchor memory</h4>
              <p>Not used</p>
            </div>
            <div class="pipe-arrow">→</div>
            <div class="pipe-node off">
              <h4>Stability gate</h4>
              <p>None</p>
            </div>
            <div class="pipe-arrow">→</div>
            <div class="pipe-node update">
              <h4>Update</h4>
              <p>\(\theta_{t+1} = \theta_t - \eta_t g_{d,t}\)</p>
            </div>
            <div class="pipe-arrow">→</div>
            <div class="pipe-node output">
              <h4>Output</h4>
              <p>\((\mu_t,\Sigma_t)\mapsto w_t^\star\)</p>
            </div>
          </div>

          <div class="strategy-meta">
            <article>
              <h4>Protects</h4>
              <p>Immediate fit to the newest regime.</p>
            </article>
            <article>
              <h4>Trade-off</h4>
              <p>Unbounded forgetting under persistent drift.</p>
            </article>
            <article>
              <h4>Production analog</h4>
              <p>Unconstrained live model refresh.</p>
            </article>
          </div>
        </article>

        <article class="strategy-card">
          <header>
            <p class="method-tag">Established baseline</p>
            <h3>Strategy B: Anchor-regularized update</h3>
            <p class="strategy-claim">Adds replay pressure so stress behavior decays more slowly.</p>
          </header>

          <div class="pipeline-diagram">
            <div class="pipe-node source">
              <h4>Input</h4>
              <p>Drift batch \(\mathcal{D}^{\mathrm{drift}}_t\)</p>
            </div>
            <div class="pipe-arrow">→</div>
            <div class="pipe-node memory">
              <h4>Anchor memory</h4>
              <p>Stress set \(\mathcal{D}^{\mathrm{anchor}}_t\)</p>
            </div>
            <div class="pipe-arrow">→</div>
            <div class="pipe-node soft">
              <h4>Stability gate</h4>
              <p>Soft weight \(\beta_t\)</p>
            </div>
            <div class="pipe-arrow">→</div>
            <div class="pipe-node update">
              <h4>Update</h4>
              <p>\(\theta_{t+1}=\theta_t-\eta_t\!\left(g_{d,t}+\beta_t g_{a,t}\right)\)</p>
            </div>
            <div class="pipe-arrow">→</div>
            <div class="pipe-node output">
              <h4>Output</h4>
              <p>\((\mu_t,\Sigma_t)\mapsto w_t^\star\)</p>
            </div>
          </div>

          <div class="strategy-meta">
            <article>
              <h4>Protects</h4>
              <p>Anchor behavior through continuous replay.</p>
            </article>
            <article>
              <h4>Trade-off</h4>
              <p>Protection weakens when drift pressure accumulates.</p>
            </article>
            <article>
              <h4>Production analog</h4>
              <p>Penalty-based shrinkage to a stress reference model.</p>
            </article>
          </div>
        </article>

        <article class="strategy-card">
          <header>
            <p class="method-tag proposed">Proposed in this work</p>
            <h3>Strategy C: Anchor + projection update</h3>
            <p class="strategy-claim">Hard interference control: update only if anchor behavior remains within budget.</p>
          </header>

          <div class="pipeline-diagram">
            <div class="pipe-node source">
              <h4>Input</h4>
              <p>Drift batch \(\mathcal{D}^{\mathrm{drift}}_t\)</p>
            </div>
            <div class="pipe-arrow">→</div>
            <div class="pipe-node memory">
              <h4>Anchor memory</h4>
              <p>Stress set \(\mathcal{D}^{\mathrm{anchor}}_t\)</p>
            </div>
            <div class="pipe-arrow">→</div>
            <div class="pipe-node hard">
              <h4>Stability gate</h4>
              <p>\(\tilde g_t=\Pi(g_{d,t}\mid g_{a,t},\varepsilon_t)\)</p>
            </div>
            <div class="pipe-arrow">→</div>
            <div class="pipe-node update">
              <h4>Update</h4>
              <p>\(\theta_{t+1}=\theta_t-\eta_t\!\left(\tilde g_t+\beta_t g_{a,t}\right)\)</p>
            </div>
            <div class="pipe-arrow">→</div>
            <div class="pipe-node output">
              <h4>Output</h4>
              <p>\((\mu_t,\Sigma_t)\mapsto w_t^\star\)</p>
            </div>
          </div>

          <div class="strategy-meta">
            <article>
              <h4>Protects</h4>
              <p>Anchor alignment under explicit interference budget.</p>
            </article>
            <article>
              <h4>Trade-off</h4>
              <p>Accepts controlled drift-fit cost for stability guarantees.</p>
            </article>
            <article>
              <h4>Production analog</h4>
              <p>Hard risk gate before state promotion to production.</p>
            </article>
          </div>
        </article>
      </section>

      <section class="section" id="workspace" aria-label="Validation Workspace">
        <h2>3. Evidence Workspace</h2>
        <p class="section-intro">
          Evaluate the same data stream under three validation modes. Use this section to decide if Strategy C is
          promotion-ready or should remain in pilot.
        </p>

        <article class="protocol-board">
          <h3>Validation modes</h3>
          <div class="mode-grid">
            <article class="mode-card" data-mode-card="quick_check">
              <h4>Quick</h4>
              <p>Fast directional signal check.</p>
            </article>
            <article class="mode-card" data-mode-card="proposal_like">
              <h4>Default</h4>
              <p>Deployment-like drift/stress balance.</p>
            </article>
            <article class="mode-card" data-mode-card="stress_heavy">
              <h4>Stress+</h4>
              <p>Adversarial regime concentration.</p>
            </article>
          </div>
          <p id="mode-readout" class="mode-readout"></p>
        </article>

        <div class="control-stack">
          <div class="preset-row">
            <button id="apply-quick" data-preset="quick_check" class="btn btn-ghost" type="button">Quick</button>
            <button id="apply-proposal" data-preset="proposal_like" class="btn btn-ghost" type="button">Default</button>
            <button id="apply-stress" data-preset="stress_heavy" class="btn btn-ghost" type="button">Stress+</button>
          </div>

          <form id="config-form" class="knob-grid">
            <label>
              Update steps
              <input name="steps" type="number" step="1" />
            </label>
            <label>
              Anchor weight
              <input name="anchorBeta" type="number" step="0.01" />
            </label>
            <label>
              Stress frequency
              <input name="pStress" type="number" step="0.01" />
            </label>
            <label>
              LoRA rank
              <input name="loraRank" type="number" step="1" />
            </label>
            <label>
              Seed
              <input name="seed" type="number" step="1" />
            </label>
          </form>

          <div class="action-row">
            <button id="run-demo" class="btn btn-primary" type="button">Run Demo</button>
            <button id="reset-form" class="btn btn-ghost" type="button">Reset</button>
            <button id="export-run" class="btn btn-ghost" type="button">Export JSON</button>
          </div>
        </div>

        <div class="run-status">
          <p id="status-line">Ready.</p>
          <div class="progress-track"><div id="progress-fill"></div></div>
        </div>

        <div class="decision-panels">
          <article id="expectation-check" class="expectation-check"></article>
          <article id="decision-card" class="decision-card"></article>
        </div>

        <div id="impact-kpis" class="kpi-row"></div>

        <div class="chart-grid">
          <article class="chart-card">
            <h3>Impact vs naive</h3>
            <p class="chart-question">Question: does added control buy stress protection worth its adaptation cost?</p>
            <canvas id="impact-chart" class="chart-canvas"></canvas>
            <p class="chart-reading" id="impact-reading"></p>
          </article>
          <article class="chart-card">
            <h3>Equity through regimes</h3>
            <p class="chart-question">Question: who survives stress pockets without collapsing during drift windows?</p>
            <canvas id="equity-chart" class="chart-canvas"></canvas>
            <p class="chart-reading" id="equity-reading"></p>
          </article>
          <article class="chart-card">
            <h3>Regime return split</h3>
            <p class="chart-question">Question: where does each method earn and where does it break?</p>
            <canvas id="regime-chart" class="chart-canvas"></canvas>
            <p class="chart-reading" id="regime-reading"></p>
          </article>
        </div>

        <article class="table-wrap">
          <h3>Method scoreboard</h3>
          <p class="table-guide">Rank methods, then re-run Stress+ with multiple seeds before any promotion call.</p>
          <table id="method-table" class="method-table"></table>
        </article>

        <article id="takeaway" class="takeaway"></article>
      </section>

      <section class="section" id="math">
        <h2>4. Mathematical Spine (Discipline and Boundary)</h2>
        <p class="section-intro">
          This section separates what is established in the literature from what is proposed here. Every equation is
          introduced by intent and followed by an operational implication.
        </p>

        <div class="math-boundary">
          <article class="boundary-card">
            <p class="math-tag literature">Established in literature</p>
            <p>Constrained portfolio optimization, CVaR stress control, replay, and gradient projection.</p>
          </article>
          <article class="boundary-card">
            <p class="math-tag proposal">Proposed in this work</p>
            <p>One release contract that couples fixed decision constraints with stress-gated continual updates.</p>
          </article>
        </div>

        <article class="math-cluster literature">
          <header>
            <p class="math-tag literature">Established in literature</p>
            <h3>A. Decision Layer: Optimize Feasible Weights</h3>
          </header>
          <p class="math-intuition">
            Intuition: model outputs should be transformed into trades by a deterministic constrained optimizer.
          </p>

          <div class="equation-group">
            <p class="equation-intent">Question: what is optimized at decision time?</p>
            <div class="math-block">
              \[
              \begin{aligned}
              w_t^\star
              &=
              \arg\max_{w\in\mathcal{W}_t}
              \left(
              \mu_t^\top w
              -\frac{\gamma}{2}\,w^\top\Sigma_t w
              -c_t^\top \lvert w-w_{t-1}\rvert
              \right).
              \end{aligned}
              \]
            </div>
          </div>

          <div class="equation-group">
            <p class="equation-intent">Question: which constraints define feasibility?</p>
            <div class="math-block">
              \[
              \begin{aligned}
              \mathcal{W}_t
              =
              \Big\{w\in\mathbb{R}^{N_t}:\;&
              \mathbf{1}^\top w=0,\;
              \lVert w\rVert_1\le L,\;
              \lvert w_i\rvert\le w_{\max}\;\forall i,\\
              &
              \lVert w-w_{t-1}\rVert_1\le\tau,\;
              \lVert B_t^\top w\rVert_\infty\le b_{\mathrm{factor}}
              \Big\}.
              \end{aligned}
              \]
            </div>
          </div>

          <div class="equation-group">
            <p class="equation-intent">Question: how is stress risk bounded?</p>
            <div class="math-block">
              \[
              \mathrm{ES}_{\alpha}\!\left(R^{(j)}w_t^\star\right)\ge -L_j,\qquad j=1,\dots,J.
              \]
            </div>
          </div>

          <p class="math-implication">
            Implication: no update policy can violate feasibility or stress budgets once \(w_t^\star\) is computed.
          </p>
          <p class="math-attribution">
            Attribution:
            <a href="https://web.stanford.edu/~boyd/papers/pdf/cvx_portfolio.pdf" target="_blank" rel="noreferrer"
              >Boyd et al. (2017)</a
            >,
            <a href="https://www.sciencedirect.com/science/article/pii/S0927539899000525" target="_blank" rel="noreferrer"
              >Rockafellar and Uryasev (2000)</a
            >.
          </p>
        </article>

        <article class="math-cluster literature">
          <header>
            <p class="math-tag literature">Established in literature</p>
            <h3>B. Continual Learning Stabilizers</h3>
          </header>
          <p class="math-intuition">
            Intuition: update for drift, but prevent first-order interference with stress-memory gradients.
          </p>

          <div class="equation-group">
            <p class="equation-intent">Question: what gradients are being balanced?</p>
            <div class="math-block">
              \[
              g_{d,t}=\nabla_{\theta}\mathcal{L}_{\mathrm{drift},t}(\theta_t),\qquad
              g_{a,t}=\nabla_{\theta}\mathcal{L}_{\mathrm{anchor},t}(\theta_t).
              \]
            </div>
          </div>

          <div class="equation-group">
            <p class="equation-intent">Question: how is replay distillation formalized?</p>
            <div class="math-block">
              \[
              \mathcal{L}^{\mathrm{replay}}_t(\theta)
              =
              \mathcal{L}_{\mathrm{drift},t}(\theta)
              +
              \lambda_t\,\mathbb{E}_{(x,z)\sim\mathcal{M}_t}
              \!\left[
              \left(\mu_{\theta_t}(x,z)-\mu_{\theta}(x,z)\right)^2
              \right].
              \]
            </div>
          </div>

          <div class="equation-group">
            <p class="equation-intent">Question: how is interference constrained?</p>
            <div class="math-block">
              \[
              \begin{aligned}
              \tilde g_t
              &=
              \arg\min_{v}\;\frac{1}{2}\lVert v-g_{d,t}\rVert_2^2\\
              &\text{s.t.}\quad \langle v,g_{a,t}\rangle\ge-\varepsilon_t.
              \end{aligned}
              \]
            </div>
          </div>

          <p class="math-implication">
            Implication: the update remains as close as possible to drift improvement while respecting anchor safety.
          </p>
          <p class="math-attribution">
            Attribution:
            <a href="https://openreview.net/forum?id=Hkf2_sC5FX" target="_blank" rel="noreferrer"
              >Chaudhry et al. (A-GEM, 2019)</a
            >,
            <a href="https://arxiv.org/abs/2405.13383" target="_blank" rel="noreferrer">Qiao et al. (2024)</a>,
            <a href="https://arxiv.org/abs/2106.09685" target="_blank" rel="noreferrer">Hu et al. (LoRA, 2022)</a>.
          </p>
        </article>

        <article class="math-cluster proposal">
          <header>
            <p class="math-tag proposal">Proposed in this work</p>
            <h3>C. Unified Release Contract (Update + Gate + Boundary)</h3>
          </header>
          <p class="math-intuition">
            Intuition: only the adapter state is mutable, and every candidate update must pass stress regression before
            promotion.
          </p>

          <div class="equation-group">
            <p class="equation-intent">Question: what interface is allowed to move?</p>
            <div class="math-block">
              \[
              \mu_t=f_{\theta_t}(x_t,z_t),\qquad
              \theta_t=\theta_{\mathrm{frozen}}+\Delta\theta_t,\qquad
              \Delta\theta_t\in\mathcal{S}_{\mathrm{LoRA}}.
              \]
            </div>
          </div>

          <div class="equation-group">
            <p class="equation-intent">Question: what memory object is explicitly preserved?</p>
            <div class="math-block">
              \[
              \mathcal{M}_t=
              \mathcal{M}^{\mathrm{recent}}_t
              \cup
              \left(\bigcup_{j=1}^{J}\mathcal{M}^{\mathrm{stress}(j)}\right)
              \cup
              \mathcal{M}^{\mathrm{edge}}_t.
              \]
            </div>
          </div>

          <div class="equation-group">
            <p class="equation-intent">Question: when is a candidate update accepted?</p>
            <div class="math-block">
              \[
              \theta_{t+1}
              =
              \begin{cases}
              \theta_t', &
              \mathcal{L}_{\mathrm{stress}}(\theta_t')
              \le
              (1+\delta_t)\,\mathcal{L}_{\mathrm{stress}}(\theta_t),\\[2pt]
              \theta_t, & \text{otherwise (rollback).}
              \end{cases}
              \]
            </div>
          </div>

          <p class="math-implication">
            Implication: the proposed contribution is a single auditable contract linking model adaptation to
            non-regression criteria while preserving a fixed decision boundary.
          </p>
        </article>

        <article class="notation-card">
          <h3>Notation (Defined Once, Reused Consistently)</h3>
          <table class="notation-table">
            <thead>
              <tr>
                <th>Symbol</th>
                <th>Meaning</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>\(x_t,z_t\)</td><td>Numeric market state and text context at time \(t\)</td></tr>
              <tr><td>\(\theta_t\)</td><td>Adapter parameter state after accepted update \(t\)</td></tr>
              <tr><td>\(\mu_t\)</td><td>Predicted residual alpha vector</td></tr>
              <tr><td>\(\Sigma_t\)</td><td>Risk covariance primitive</td></tr>
              <tr><td>\(w_t^\star\)</td><td>Executed feasible portfolio weights</td></tr>
              <tr><td>\(\mathcal{W}_t\)</td><td>Feasible weight set with risk and turnover constraints</td></tr>
              <tr><td>\(\mathcal{M}_t\)</td><td>Replay memory fixture (recent + stress + edge)</td></tr>
              <tr><td>\(g_{d,t},g_{a,t},\tilde g_t\)</td><td>Drift, anchor, and projected update gradients</td></tr>
              <tr><td>\(\delta_t\)</td><td>Stress-loss tolerance used by promotion gate</td></tr>
            </tbody>
          </table>
        </article>
      </section>

      <section class="section" id="references">
        <h2>5. References</h2>
        <div class="refs-grid">
          <article>
            <h3>Papers</h3>
            <ul id="ref-papers" class="ref-list"></ul>
          </article>
          <article>
            <h3>Datasets</h3>
            <ul id="ref-datasets" class="ref-list"></ul>
          </article>
          <article>
            <h3>Repositories</h3>
            <ul id="ref-repos" class="ref-list"></ul>
          </article>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div class="shell footer-inner">
        <a href="#top" class="inline-link">Back to top</a>
        <p>Understand mechanism -> run shared-stream evidence -> make deployment decision.</p>
      </div>
    </footer>

    <script>
      window.MathJax = {
        tex: {
          inlineMath: [["\\(", "\\)"]],
          displayMath: [["\\[", "\\]"]],
        },
        svg: {
          fontCache: "global",
        },
      };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <script type="module" src="./src/main.js"></script>
  </body>
</html>
