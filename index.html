<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CL-PLO | Strategy Pipelines and Validation</title>
    <link rel="stylesheet" href="./coreline.css" />
  </head>
  <body>
    <header class="hero">
      <div class="shell">
        <h1>How each continual-learning strategy actually works</h1>
        <p class="lead">
          If you are deciding whether to trust this mechanism, this page is designed to answer one question quickly:
          where do memory and constraints enter the update, and how does that change the portfolio decision path?
        </p>
        <div class="hero-actions">
          <a class="btn btn-primary" href="#pipelines">Read Pipelines</a>
          <a class="btn btn-ghost" href="#validation">Run Validation</a>
        </div>
      </div>
    </header>

    <main class="shell">
      <section id="map" class="section">
        <h2>Reading map</h2>
        <div class="reading-map">
          <article>
            <h3>1. Shared system</h3>
            <p>See what stays fixed across all methods.</p>
          </article>
          <article>
            <h3>2. Three strategy pipelines</h3>
            <p>See exactly what each strategy adds or constrains.</p>
          </article>
          <article>
            <h3>3. Validation run</h3>
            <p>Check if results follow what the pipelines predict.</p>
          </article>
        </div>
      </section>

      <section id="shared" class="section">
        <h2>Shared system (constant for all strategies)</h2>
        <p class="section-intro">
          Only the adapter update rule changes. The data streams, frozen backbone, and portfolio optimizer are shared.
        </p>

        <div class="system-board">
          <div class="system-step">
            <span class="step-id">1</span>
            <h3>Inputs</h3>
            <p>Market features, macro context, text signals</p>
            <p class="math">\(x_t\)</p>
          </div>
          <div class="system-link">&rarr;</div>
          <div class="system-step frozen">
            <span class="step-id">2</span>
            <h3>Backbone</h3>
            <p>Base model parameters are frozen</p>
            <p class="math">\(\phi\)</p>
          </div>
          <div class="system-link">&rarr;</div>
          <div class="system-step updated">
            <span class="step-id">3</span>
            <h3>Adapter</h3>
            <p>Only LoRA parameters are updated</p>
            <p class="math">\(\theta_t\)</p>
          </div>
          <div class="system-link">&rarr;</div>
          <div class="system-step">
            <span class="step-id">4</span>
            <h3>Portfolio optimizer</h3>
            <p class="math">
              \(\displaystyle
              \mathbf{w}_t^\star=
              \arg\min_{\mathbf{w}\in\mathcal{W}}
              \left(-\hat{\mu}_t^\top\mathbf{w}+\frac{\gamma}{2}\mathbf{w}^\top\hat{\Sigma}_t\mathbf{w}+\lambda_{\mathrm{tc}}\lVert\mathbf{w}-\mathbf{w}_{t-1}\rVert_1\right)
              \)
            </p>
          </div>
        </div>
      </section>

      <section id="pipelines" class="section">
        <h2>Strategy pipelines</h2>
        <p class="section-intro">
          All three strategies use the same five pipeline columns below. This makes differences explicit and
          comparable.
        </p>

        <div class="pipeline-legend">
          <span class="legend-item frozen">Frozen component</span>
          <span class="legend-item memory">Memory / anchor store</span>
          <span class="legend-item constraint">Constraint operator</span>
          <span class="legend-item updated">Updated component</span>
        </div>

        <article class="strategy-card">
          <header class="strategy-head">
            <h3>Strategy A: Naive continual update</h3>
            <p>Plain language: adapt immediately to current drift; no explicit memory protection.</p>
          </header>
          <div class="pipeline-grid">
            <div class="col-head">Inputs</div>
            <div class="col-head">Memory</div>
            <div class="col-head">Constraint</div>
            <div class="col-head">Update</div>
            <div class="col-head">Output</div>

            <div class="cell">Drift stream \(\mathcal{D}^{\mathrm{drift}}_t\)</div>
            <div class="cell">None</div>
            <div class="cell">None</div>
            <div class="cell updated">\(\mathbf{g}_{\mathrm{d}}=\nabla\mathcal{L}_{\mathrm{drift}}\), \(\theta_{t+1}=\theta_t-\eta\mathbf{g}_{\mathrm{d}}\)</div>
            <div class="cell">Forecasts \(\hat{\mu}_t,\hat{\Sigma}_t\) \(\rightarrow\) weights \(\mathbf{w}_t^\star\)</div>
          </div>
        </article>

        <article class="strategy-card">
          <header class="strategy-head">
            <h3>Strategy B: Anchor-regularized update</h3>
            <p>Plain language: reuse stress memory as a soft penalty so updates are less forgetful.</p>
          </header>
          <div class="pipeline-grid">
            <div class="col-head">Inputs</div>
            <div class="col-head">Memory</div>
            <div class="col-head">Constraint</div>
            <div class="col-head">Update</div>
            <div class="col-head">Output</div>

            <div class="cell">\(\mathcal{D}^{\mathrm{drift}}_t\)</div>
            <div class="cell memory">
              Anchor set \(\mathcal{D}^{\mathrm{anchor}}_t\)
              <ul class="examples">
                <li>"2008 credit spread dislocation"</li>
                <li>"2020 limit-down shock"</li>
                <li>"2022 inflation surprise"</li>
              </ul>
            </div>
            <div class="cell">Soft via \(\beta\)</div>
            <div class="cell updated">\(\min_{\theta}\,\mathcal{L}_{\mathrm{drift}}+\beta\mathcal{L}_{\mathrm{anchor}}\), \(\theta_{t+1}=\theta_t-\eta\nabla\mathcal{L}\)</div>
            <div class="cell">\(\hat{\mu}_t,\hat{\Sigma}_t\rightarrow\mathbf{w}_t^\star\)</div>
          </div>
        </article>

        <article class="strategy-card">
          <header class="strategy-head">
            <h3>Strategy C: Anchor + projection (proposed)</h3>
            <p>Plain language: enforce memory protection directly in gradient geometry before the update is applied.</p>
          </header>
          <div class="pipeline-grid">
            <div class="col-head">Inputs</div>
            <div class="col-head">Memory</div>
            <div class="col-head">Constraint</div>
            <div class="col-head">Update</div>
            <div class="col-head">Output</div>

            <div class="cell">Drift gradient \(\mathbf{g}_{\mathrm{d}}\)</div>
            <div class="cell memory">
              Anchor gradient \(\mathbf{g}_{\mathrm{a}}\)
              <ul class="examples">
                <li>Stress-memory snapshots</li>
                <li>Regime archive: calm, inflation, liquidity shock</li>
              </ul>
            </div>
            <div class="cell constraint">
              \(\tilde{\mathbf{g}}=\Pi_{\mathcal{C}_{\varepsilon}}(\mathbf{g}_{\mathrm{d}})\)
              <p class="math-small">\(\mathcal{C}_{\varepsilon}=\{\mathbf{g}:\langle\mathbf{g},\mathbf{g}_{\mathrm{a}}\rangle\ge-\varepsilon\}\)</p>
            </div>
            <div class="cell updated">\(\theta_{t+1}=\theta_t-\eta\tilde{\mathbf{g}}\)</div>
            <div class="cell">\(\hat{\mu}_t,\hat{\Sigma}_t\rightarrow\mathbf{w}_t^\star\)</div>
          </div>
        </article>
      </section>

      <section id="validation" class="section" aria-label="Validation">
        <h2>Validation run</h2>
        <p class="section-intro">
          This section checks whether observed behavior matches the pipeline logic above.
        </p>
        <article id="expectation-check" class="expectation-check"></article>

        <div class="control-stack">
          <div class="preset-row">
            <button id="apply-quick" class="btn btn-ghost" type="button">Quick</button>
            <button id="apply-proposal" class="btn btn-ghost" type="button">Default</button>
            <button id="apply-stress" class="btn btn-ghost" type="button">Stress+</button>
          </div>

          <form id="config-form" class="knob-grid">
            <label>Update steps<input name="steps" type="number" step="1" /></label>
            <label>Anchor weight<input name="anchorBeta" type="number" step="0.01" /></label>
            <label>Stress frequency<input name="pStress" type="number" step="0.01" /></label>
            <label>LoRA rank<input name="loraRank" type="number" step="1" /></label>
            <label>Seed<input name="seed" type="number" step="1" /></label>
          </form>

          <div class="action-row">
            <button id="run-demo" class="btn btn-primary" type="button">Run validation</button>
            <button id="reset-form" class="btn btn-ghost" type="button">Reset</button>
            <button id="export-run" class="btn btn-ghost" type="button">Export JSON</button>
          </div>
        </div>

        <div class="run-status">
          <p id="status-line">Ready.</p>
          <div class="progress-track"><div id="progress-fill"></div></div>
        </div>

        <article id="decision-card" class="decision-card"></article>
        <div id="impact-kpis" class="kpi-row"></div>

        <div class="chart-grid">
          <article>
            <h3>Impact vs naive</h3>
            <canvas id="impact-chart" class="chart-canvas"></canvas>
          </article>
          <article>
            <h3>Equity curves</h3>
            <canvas id="equity-chart" class="chart-canvas"></canvas>
          </article>
        </div>

        <article class="table-wrap">
          <h3>Method scoreboard</h3>
          <table id="method-table" class="method-table"></table>
        </article>

        <article id="takeaway" class="takeaway"></article>
      </section>
    </main>

    <script>
      window.MathJax = {
        tex: {
          inlineMath: [["\\(", "\\)"]],
          displayMath: [["\\[", "\\]"]],
        },
        svg: {
          fontCache: "global",
        },
      };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <script type="module" src="./src/main.js"></script>
  </body>
</html>
