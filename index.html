<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CL-PLO Spine | Stable Transformer Updates for Portfolio Decisions</title>
    <link rel="stylesheet" href="./coreline.css" />
  </head>
  <body>
    <header class="executive" id="top">
      <div class="shell">
        <h1>CL-PLO: Stable Transformer Updates for LLM Portfolio Systems</h1>

        <article class="exec-card" aria-label="30 second executive card">
          <div class="exec-problem">
            <span class="exec-label">Problem</span>
            <span class="exec-line">Fast adapter updates track drift, then fail stress behavior when risk posture matters most.</span>
          </div>

          <div class="exec-state">
            <div>
              <span class="exec-label">Frozen</span>
              <span class="exec-line">Transformer backbone, optimizer constraints</span>
            </div>
            <div>
              <span class="exec-label">Updated</span>
              <span class="exec-line">LoRA adapter update operator</span>
            </div>
          </div>

          <div class="exec-strategies" aria-label="three update strategies">
            <div><span class="icon">A</span><span>Naive online: fastest adaptation, no stability gate.</span></div>
            <div><span class="icon">B</span><span>Replay only: keeps stress memory via anchor replay.</span></div>
            <div><span class="icon proposed">C</span><span>Replay + projection: enforces a hard safe-update boundary.</span></div>
          </div>

          <figure class="exec-figure" aria-label="decisive figure thumbnail">
            <img src="./assets/validation_wide.png" alt="Validation figure thumbnail: constrained update dominates stress retention and drawdown" />
          </figure>
        </article>
      </div>
    </header>

    <main class="shell flow">
      <section class="section" id="strategies">
        <h2>1. Three Strategy Mechanisms</h2>

        <div class="strategy-grid">
          <article class="strategy-card">
            <header>
              <p class="method-tag">A · Baseline</p>
              <h3>Naive Online Update</h3>
            </header>

            <svg class="pipeline-svg" viewBox="0 0 980 180" role="img" aria-label="Naive strategy pipeline">
              <defs>
                <marker id="arrow-a" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                  <path d="M0,0 L8,4 L0,8 z" fill="#1f1f1f" />
                </marker>
              </defs>

              <rect x="20" y="56" width="164" height="68" class="node data" />
              <text x="102" y="83" text-anchor="middle">Stream</text>
              <text x="102" y="104" text-anchor="middle">D_drift,t</text>

              <line x1="184" y1="90" x2="212" y2="90" marker-end="url(#arrow-a)" class="link" />

              <rect x="220" y="56" width="164" height="68" class="node frozen" />
              <text x="302" y="83" text-anchor="middle">Frozen Backbone</text>
              <text x="302" y="104" text-anchor="middle">phi</text>

              <line x1="384" y1="90" x2="412" y2="90" marker-end="url(#arrow-a)" class="link" />

              <rect x="420" y="56" width="164" height="68" class="node memory off" />
              <text x="502" y="83" text-anchor="middle">Anchor Fixture</text>
              <text x="502" y="104" text-anchor="middle">not used</text>

              <line x1="584" y1="90" x2="612" y2="90" marker-end="url(#arrow-a)" class="link" />

              <rect x="620" y="56" width="164" height="68" class="node update risk" />
              <text x="702" y="83" text-anchor="middle">Update Operator</text>
              <text x="702" y="104" text-anchor="middle">theta - eta g_d</text>

              <line x1="784" y1="90" x2="812" y2="90" marker-end="url(#arrow-a)" class="link" />

              <rect x="820" y="56" width="140" height="68" class="node decision" />
              <text x="890" y="83" text-anchor="middle">Decision Layer</text>
              <text x="890" y="104" text-anchor="middle">(mu,Sigma)->w*</text>
            </svg>

            <p class="strategy-line">Protects: update speed. Sacrifices: stress-memory stability.</p>
          </article>

          <article class="strategy-card">
            <header>
              <p class="method-tag">B · Baseline</p>
              <h3>Replay-Regularized</h3>
            </header>

            <svg class="pipeline-svg" viewBox="0 0 980 180" role="img" aria-label="Replay strategy pipeline">
              <defs>
                <marker id="arrow-b" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                  <path d="M0,0 L8,4 L0,8 z" fill="#1f1f1f" />
                </marker>
              </defs>

              <rect x="20" y="56" width="164" height="68" class="node data" />
              <text x="102" y="83" text-anchor="middle">Stream</text>
              <text x="102" y="104" text-anchor="middle">D_drift,t</text>

              <line x1="184" y1="90" x2="212" y2="90" marker-end="url(#arrow-b)" class="link" />

              <rect x="220" y="56" width="164" height="68" class="node frozen" />
              <text x="302" y="83" text-anchor="middle">Frozen Backbone</text>
              <text x="302" y="104" text-anchor="middle">phi</text>

              <line x1="384" y1="90" x2="412" y2="90" marker-end="url(#arrow-b)" class="link" />

              <rect x="420" y="56" width="164" height="68" class="node memory" />
              <text x="502" y="83" text-anchor="middle">Anchor Fixture</text>
              <text x="502" y="104" text-anchor="middle">D_anchor,t</text>

              <line x1="584" y1="90" x2="612" y2="90" marker-end="url(#arrow-b)" class="link" />

              <rect x="620" y="56" width="164" height="68" class="node update" />
              <text x="702" y="83" text-anchor="middle">Update Operator</text>
              <text x="702" y="104" text-anchor="middle">theta - eta(g_d+beta g_a)</text>

              <line x1="784" y1="90" x2="812" y2="90" marker-end="url(#arrow-b)" class="link" />

              <rect x="820" y="56" width="140" height="68" class="node decision" />
              <text x="890" y="83" text-anchor="middle">Decision Layer</text>
              <text x="890" y="104" text-anchor="middle">(mu,Sigma)->w*</text>
            </svg>

            <p class="strategy-line">Protects: replayed stress behavior. Sacrifices: no hard interference control.</p>
          </article>

          <article class="strategy-card">
            <header>
              <p class="method-tag proposed">C · Proposed</p>
              <h3>Replay + Projection Gate</h3>
            </header>

            <svg class="pipeline-svg" viewBox="0 0 980 180" role="img" aria-label="Constrained strategy pipeline">
              <defs>
                <marker id="arrow-c" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                  <path d="M0,0 L8,4 L0,8 z" fill="#1f1f1f" />
                </marker>
              </defs>

              <rect x="20" y="56" width="164" height="68" class="node data" />
              <text x="102" y="83" text-anchor="middle">Stream</text>
              <text x="102" y="104" text-anchor="middle">D_drift,t</text>

              <line x1="184" y1="90" x2="212" y2="90" marker-end="url(#arrow-c)" class="link" />

              <rect x="220" y="56" width="164" height="68" class="node frozen" />
              <text x="302" y="83" text-anchor="middle">Frozen Backbone</text>
              <text x="302" y="104" text-anchor="middle">phi</text>

              <line x1="384" y1="90" x2="412" y2="90" marker-end="url(#arrow-c)" class="link" />

              <rect x="420" y="56" width="164" height="68" class="node memory" />
              <text x="502" y="83" text-anchor="middle">Anchor Fixture</text>
              <text x="502" y="104" text-anchor="middle">D_anchor,t</text>

              <line x1="584" y1="90" x2="612" y2="90" marker-end="url(#arrow-c)" class="link" />

              <rect x="620" y="56" width="164" height="68" class="node update proposed" />
              <text x="702" y="83" text-anchor="middle">Update Operator</text>
              <text x="702" y="104" text-anchor="middle">theta - eta(g_tilde+beta g_a)</text>

              <line x1="784" y1="90" x2="812" y2="90" marker-end="url(#arrow-c)" class="link" />

              <rect x="820" y="56" width="140" height="68" class="node decision" />
              <text x="890" y="83" text-anchor="middle">Decision Layer</text>
              <text x="890" y="104" text-anchor="middle">(mu,Sigma)->w*</text>
            </svg>

            <p class="strategy-line">Protects: stress memory with a hard safe-update boundary.</p>
          </article>
        </div>
      </section>

      <section class="section" id="objects">
        <h2>2. Concrete Anchors and Projection</h2>

        <div class="anchor-grid" aria-label="Concrete anchor fixtures">
          <article>March 2020 liquidity freeze (bid-ask blowout)</article>
          <article>Gap-open day after overnight macro shock</article>
          <article>Emergency rate decision with risk-off reversal</article>
          <article>Single-sector cascade drawdown (energy/financials)</article>
          <article>Volatility spike week (VIX regime jump)</article>
          <article>Funding stress window (cross-asset deleveraging)</article>
          <article>Policy surprise + correlation breakdown session</article>
          <article>Earnings miss cluster with crowded-factor unwind</article>
        </div>

        <figure class="projection-figure" aria-label="Projection geometry">
          <svg viewBox="0 0 720 260" class="projection-svg" role="img">
            <rect x="0" y="0" width="720" height="260" fill="#ffffff" />
            <line x1="90" y1="220" x2="90" y2="30" stroke="#222222" stroke-width="2" />
            <line x1="90" y1="220" x2="640" y2="220" stroke="#222222" stroke-width="2" />

            <line x1="90" y1="220" x2="620" y2="120" stroke="#8f2f2f" stroke-width="3" marker-end="url(#p-arrow)" />
            <text x="632" y="116">raw update g_d</text>

            <line x1="90" y1="220" x2="540" y2="72" stroke="#0f5fbf" stroke-width="3" marker-end="url(#p-arrow)" />
            <text x="552" y="68">anchor direction g_a</text>

            <line x1="240" y1="30" x2="470" y2="220" stroke="#555555" stroke-width="2" stroke-dasharray="6 6" />
            <text x="472" y="210">constraint boundary</text>

            <line x1="90" y1="220" x2="470" y2="150" stroke="#111111" stroke-width="4" marker-end="url(#p-arrow)" />
            <text x="482" y="147">projected update g_tilde</text>

            <defs>
              <marker id="p-arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                <path d="M0,0 L8,4 L0,8 z" fill="#111111" />
              </marker>
            </defs>
          </svg>
        </figure>

        <p class="object-note">Anchor fixture: persistent stress slices replayed on every update step.</p>
        <p class="object-note">Projection: replace the raw drift step with the nearest step that satisfies the safety boundary.</p>
      </section>

      <section class="section" id="math">
        <h2>3. Bounded Math (Prior vs Proposed)</h2>

        <div class="math-grid">
          <article class="math-card">
            <p class="math-tag prior">Prior work</p>
            <h3>Constrained portfolio decision</h3>
            <p class="math-block">
              \[
              w_t^*=\arg\max_{w\in\mathcal{W}}\left(
              \mu_t^\top w-\frac{\gamma}{2}w^\top\Sigma_t w-\lambda_{tc}\|w-w_{t-1}\|_1
              \right)
              \]
            </p>
            <p class="math-meaning"><strong>Operational meaning:</strong> convert forecasts to tradable weights under fixed risk and turnover limits.</p>
          </article>

          <article class="math-card">
            <p class="math-tag prior">Prior work</p>
            <h3>Replay-regularized adapter update</h3>
            <p class="math-block">
              \[
              \theta_{t+1}=\theta_t-\eta_t\nabla\Big(\mathcal{L}_{drift,t}(\theta_t)+\beta_t\mathcal{L}_{anchor,t}(\theta_t)\Big)
              \]
            </p>
            <p class="math-meaning"><strong>Operational meaning:</strong> adapt to current drift while continuously replaying stress anchors.</p>
          </article>

          <article class="math-card">
            <p class="math-tag proposed">Proposed here</p>
            <h3>Projected safe adapter update</h3>
            <p class="math-block">
              \[
              \tilde g_t=\arg\min_v\|v-g_{d,t}\|_2^2\;\text{s.t.}\;\langle v,g_{a,t}\rangle\ge -\varepsilon_t,
              \quad
              \theta_{t+1}=\theta_t-\eta_t(\tilde g_t+\beta_t g_{a,t})
              \]
            </p>
            <p class="math-meaning"><strong>Operational meaning:</strong> execute the closest drift step that does not violate anchor-memory safety.</p>
          </article>
        </div>
      </section>

      <section class="section" id="workspace" aria-label="Interactive validation workspace">
        <h2>4. Interactive Validation Workspace</h2>

        <div class="experiment-layout">
          <aside class="control-panel">
            <article class="protocol-board">
              <h3>Modes</h3>
              <div class="mode-grid">
                <article class="mode-card" data-mode-card="quick_check"><h4>Quick</h4><p>Fast directional check.</p></article>
                <article class="mode-card" data-mode-card="proposal_like"><h4>Default</h4><p>Deployment-like baseline.</p></article>
                <article class="mode-card" data-mode-card="stress_heavy"><h4>Stress+</h4><p>Adversarial release gate.</p></article>
              </div>
              <p id="mode-readout" class="mode-readout"></p>
            </article>

            <div class="control-stack">
              <div class="preset-row">
                <button id="apply-quick" data-preset="quick_check" class="btn btn-ghost" type="button">Quick</button>
                <button id="apply-proposal" data-preset="proposal_like" class="btn btn-ghost" type="button">Default</button>
                <button id="apply-stress" data-preset="stress_heavy" class="btn btn-ghost" type="button">Stress+</button>
              </div>

              <form id="config-form" class="knob-grid">
                <label>
                  Anchor weight
                  <input name="anchorBeta" type="number" step="0.01" />
                </label>
                <label>
                  LoRA rank
                  <input name="loraRank" type="number" step="1" />
                </label>
                <label>
                  Stress frequency
                  <input name="pStress" type="number" step="0.01" />
                </label>
                <label>
                  Update steps
                  <input name="steps" type="number" step="1" />
                </label>
                <label>
                  Seed
                  <input name="seed" type="number" step="1" />
                </label>
              </form>

              <div class="action-row">
                <button id="run-demo" class="btn btn-primary" type="button">Run Demo</button>
                <button id="reset-form" class="btn btn-ghost" type="button">Reset</button>
                <button id="export-run" class="btn btn-ghost" type="button">Export JSON</button>
              </div>
            </div>

            <div class="run-status">
              <p id="status-line">Ready.</p>
              <div class="progress-track"><div id="progress-fill"></div></div>
            </div>
          </aside>

          <div class="results-panel">
            <div class="decision-panels">
              <article id="expectation-check" class="expectation-check"></article>
              <article id="decision-card" class="decision-card"></article>
            </div>

            <div id="impact-kpis" class="kpi-row"></div>

            <div class="plot-stack">
              <article class="chart-card">
                <h3>Retention vs Stress Impact</h3>
                <p class="plot-caption"><strong>Shows:</strong> stress-retention gain and drawdown lift versus naive.<br /><strong>Read:</strong> convincing signal is constrained > replay on both bars.</p>
                <canvas id="impact-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="impact-reading"></p>
              </article>

              <article class="chart-card">
                <h3>Equity Curve with Stress Regimes</h3>
                <p class="plot-caption"><strong>Shows:</strong> full equity path with shaded stress windows.<br /><strong>Read:</strong> look for shallower stress drawdowns without drift collapse.</p>
                <canvas id="equity-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="equity-reading"></p>
              </article>

              <article class="chart-card">
                <h3>Regime Split (Drift vs Stress)</h3>
                <p class="plot-caption"><strong>Shows:</strong> mean returns split by drift and stress regimes.<br /><strong>Read:</strong> method quality is explicit trade-off, not hidden averaging.</p>
                <canvas id="regime-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="regime-reading"></p>
              </article>
            </div>

            <article class="table-wrap">
              <h3>Method Scoreboard</h3>
              <p class="table-guide">Use ranking for promotion decisions only after repeated Stress+ seed checks.</p>
              <table id="method-table" class="method-table"></table>
            </article>
          </div>
        </div>
      </section>

      <section class="section" id="takeaway-section">
        <h2>5. End-to-End Decision Path</h2>

        <figure class="synthesis-diagram" aria-label="End to end deployment pathway">
          <div class="syn-node">LLM stream</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node">Anchor fixture</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node proposed">Projection-gated update</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node">Fixed optimizer</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node">Release decision</div>
        </figure>

        <article id="takeaway" class="takeaway"></article>
      </section>
    </main>

    <footer class="footer">
      <div class="shell footer-inner">
        <a href="#top" class="inline-link">Back to top</a>
      </div>
    </footer>

    <script>
      window.MathJax = {
        tex: {
          inlineMath: [["\\(", "\\)"]],
          displayMath: [["\\[", "\\]"]],
        },
        svg: {
          fontCache: "global",
        },
      };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <script type="module" src="./src/main.js"></script>
  </body>
</html>
