<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CL-PLO Spine | Stable Transformer Updates for Portfolio Decisions</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./coreline.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" />
  </head>
  <body>
    <header class="executive" id="top">
      <div class="shell">
        <article class="hero-insight" aria-label="Decision summary">
          <p class="hero-kicker">CL-PLO Decision Spine</p>
          <h1>In deployed transformer portfolios, update control is the real risk control.</h1>

          <div class="hero-grid">
            <article class="hero-mini">
              <p class="hero-mini-title">Problem</p>
              <p>Drift-only adaptation tracks calm windows and loses stress behavior.</p>
            </article>
            <article class="hero-mini">
              <p class="hero-mini-title">Controlled Variable</p>
              <p>Backbone, optimizer, and limits stay fixed; only the updater changes.</p>
            </article>
            <article class="hero-mini">
              <p class="hero-mini-title">Decision Claim</p>
              <p>Replay + projection preserves stress memory while enforcing feasible updates.</p>
            </article>
          </div>

          <div class="hero-method-row" aria-label="Three strategy one-line summaries">
            <p><span>A</span>Naive: drift-only update.</p>
            <p><span>B</span>Replay: drift + anchor replay.</p>
            <p><span>C</span>Hybrid: replay + projection gate.</p>
          </div>

          <div class="hero-result">
            <p class="hero-signal">
              <strong>Default signal:</strong> hybrid keeps retention and drawdown in control without freezing adaptation.
            </p>
            <article class="hero-proof" aria-label="One-screen check">
              <h3>Gate Snapshot</h3>
              <div class="proof-row">
                <span>Naive</span>
                <span class="proof-metric">weak under stress</span>
              </div>
              <div class="proof-row">
                <span>Replay</span>
                <span class="proof-metric">retention improves</span>
              </div>
              <div class="proof-row highlight">
                <span>Hybrid</span>
                <span class="proof-metric">retention with hard control</span>
              </div>
              <p class="proof-note">Check Quick, Default, Stress+ and confirm ordering remains stable.</p>
            </article>
          </div>
        </article>
      </div>
    </header>

    <main class="shell flow">
      <section class="section" id="strategies">
        <h2>1. Three Strategy Mechanisms</h2>
        <p class="section-note">One production problem drives the full design: the model must adapt to new flow without dropping stress behavior that protects capital. Each strategy below uses the same LLM stream and the same portfolio optimizer. Only the update operator changes.</p>

        <div class="pipeline-legend" aria-label="Pipeline role legend">
          <span><i class="swatch data"></i>Stream input</span>
          <span><i class="swatch memory"></i>Anchor memory</span>
          <span><i class="swatch update"></i>Update operator</span>
          <span><i class="swatch decision"></i>Decision layer</span>
        </div>

        <div class="mechanism-stack">
          <article class="mechanism-card">
            <header class="mechanism-head">
              <p class="method-tag">A · Prior literature</p>
              <h3>Naive Drift Update</h3>
              <p class="mechanism-intuition">The updater follows the current stream only. Adaptation is fast, but stress fixtures are not replayed into the step.</p>
            </header>

            <figure class="pipeline-canvas" aria-label="Naive strategy pipeline">
              <div class="pipe-row">
                <article class="pipe-node role-data">
                  <p class="pipe-cap">Stream</p>
                  <h4>LLM market stream</h4>
                  <p class="pipe-sub">tokens + returns</p>
                  <p class="pipe-inline-math">\(x_t\)</p>
                </article>

                <article class="pipe-node role-core">
                  <p class="pipe-cap">Frozen core</p>
                  <h4>Transformer backbone</h4>
                  <p class="pipe-sub">weights frozen</p>
                </article>

                <article class="pipe-node role-memory muted">
                  <p class="pipe-cap">Anchor memory</p>
                  <h4>Anchor set \(A_t\)</h4>
                  <p class="pipe-sub">stored, not injected</p>
                </article>

                <article class="pipe-node role-update">
                  <p class="pipe-cap">Update</p>
                  <h4>Raw drift step</h4>
                  <div class="pipe-math">\[\theta_{t+1}=\theta_t-\eta_t g_{d,t}\]</div>
                  <p class="pipe-origin prior">Prior work</p>
                </article>

                <article class="pipe-node role-decision">
                  <p class="pipe-cap">Decision</p>
                  <h4>Portfolio optimizer</h4>
                  <p class="pipe-sub">weights \(w_t\)</p>
                </article>
              </div>

              <svg class="pipe-overlay" viewBox="0 0 1000 210" preserveAspectRatio="none" aria-hidden="true">
                <defs>
                  <marker id="pipe-arrow-a" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                    <path d="M0,0 L10,5 L0,10 z" fill="#2f3d50"></path>
                  </marker>
                </defs>
                <path d="M165 92 L245 92" marker-end="url(#pipe-arrow-a)"></path>
                <path d="M365 92 L445 92" marker-end="url(#pipe-arrow-a)"></path>
                <path d="M565 92 L645 92" marker-end="url(#pipe-arrow-a)"></path>
                <path d="M765 92 L845 92" marker-end="url(#pipe-arrow-a)"></path>
              </svg>
            </figure>

            <div class="mechanism-concrete">
              <p class="mechanism-concrete-title">Concrete fixture view</p>
              <div class="fixture-row">
                <span class="fixture-chip risk">Liquidity freeze</span>
                <span class="fixture-chip risk">Gap-open shock</span>
                <span class="fixture-chip risk">Volatility cluster</span>
              </div>
              <p class="mechanism-concrete-note">These fixtures exist in memory, but this strategy does not replay them during the update.</p>
            </div>
          </article>

          <article class="mechanism-card">
            <header class="mechanism-head">
              <p class="method-tag">B · Prior literature</p>
              <h3>Replay-Regularized Update</h3>
              <p class="mechanism-intuition">Stress fixtures are replayed into every update. Retention improves, but the mixed step can still violate a tight risk budget.</p>
            </header>

            <figure class="pipeline-canvas has-arc" aria-label="Replay strategy pipeline">
              <div class="pipe-row">
                <article class="pipe-node role-data">
                  <p class="pipe-cap">Stream</p>
                  <h4>LLM market stream</h4>
                  <p class="pipe-sub">tokens + returns</p>
                  <p class="pipe-inline-math">\(x_t\)</p>
                </article>

                <article class="pipe-node role-core">
                  <p class="pipe-cap">Frozen core</p>
                  <h4>Transformer backbone</h4>
                  <p class="pipe-sub">weights frozen</p>
                </article>

                <article class="pipe-node role-memory">
                  <p class="pipe-cap">Anchor memory</p>
                  <h4>Replay set \(A_t\)</h4>
                  <p class="pipe-sub">fixtures injected</p>
                  <p class="pipe-inline-math">\(g_{a,t}\)</p>
                </article>

                <article class="pipe-node role-update">
                  <p class="pipe-cap">Update</p>
                  <h4>Replay-mixed step</h4>
                  <div class="pipe-math">\[\theta_{t+1}=\theta_t-\eta_t\left(g_{d,t}+\beta_t g_{a,t}\right)\]</div>
                  <p class="pipe-origin prior">Prior work</p>
                </article>

                <article class="pipe-node role-decision">
                  <p class="pipe-cap">Decision</p>
                  <h4>Portfolio optimizer</h4>
                  <p class="pipe-sub">weights \(w_t\)</p>
                </article>
              </div>

              <svg class="pipe-overlay" viewBox="0 0 1000 210" preserveAspectRatio="none" aria-hidden="true">
                <defs>
                  <marker id="pipe-arrow-b" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                    <path d="M0,0 L10,5 L0,10 z" fill="#2f3d50"></path>
                  </marker>
                  <marker id="pipe-arc-b" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                    <path d="M0,0 L10,5 L0,10 z" fill="#7a6245"></path>
                  </marker>
                </defs>
                <path d="M165 92 L245 92" marker-end="url(#pipe-arrow-b)"></path>
                <path d="M365 92 L445 92" marker-end="url(#pipe-arrow-b)"></path>
                <path d="M565 92 L645 92" marker-end="url(#pipe-arrow-b)"></path>
                <path d="M765 92 L845 92" marker-end="url(#pipe-arrow-b)"></path>
                <path class="arc" d="M505 132 C 560 188, 640 188, 695 132" marker-end="url(#pipe-arc-b)"></path>
              </svg>
            </figure>

            <div class="mechanism-concrete">
              <p class="mechanism-concrete-title">Concrete fixture view</p>
              <div class="fixture-row">
                <span class="fixture-chip">A1 · Liquidity freeze</span>
                <span class="fixture-chip">A2 · Gap-open day</span>
                <span class="fixture-chip">A3 · Correlation break</span>
              </div>
              <p class="mechanism-concrete-note">Each anchor chip is replayed as a mini-batch before the trade decision is generated.</p>
            </div>
          </article>

          <article class="mechanism-card">
            <header class="mechanism-head">
              <p class="method-tag proposed">C · Proposed here</p>
              <h3>Replay + Projection Gate</h3>
              <p class="mechanism-intuition">The drift step is first projected to the feasible region, then replay memory is added. Adaptation stays active while updates remain risk-valid.</p>
            </header>

            <figure class="pipeline-canvas has-arc" aria-label="Hybrid replay projection strategy pipeline">
              <div class="pipe-row">
                <article class="pipe-node role-data">
                  <p class="pipe-cap">Stream</p>
                  <h4>LLM market stream</h4>
                  <p class="pipe-sub">tokens + returns</p>
                  <p class="pipe-inline-math">\(x_t\)</p>
                </article>

                <article class="pipe-node role-core">
                  <p class="pipe-cap">Frozen core</p>
                  <h4>Transformer backbone</h4>
                  <p class="pipe-sub">weights frozen</p>
                </article>

                <article class="pipe-node role-memory">
                  <p class="pipe-cap">Anchor memory</p>
                  <h4>Replay set \(A_t\)</h4>
                  <p class="pipe-sub">fixtures injected</p>
                  <p class="pipe-inline-math">\(g_{a,t}\)</p>
                </article>

                <article class="pipe-node role-update">
                  <p class="pipe-cap">Update</p>
                  <h4>Projected mixed step</h4>
                  <div class="pipe-math">
                    \[
                    \tilde g_t=\Pi_{\mathcal{H}_t}(g_{d,t}),\quad
                    \theta_{t+1}=\theta_t-\eta_t\left(\tilde g_t+\beta_t g_{a,t}\right)
                    \]
                  </div>
                  <p class="pipe-origin proposed">Proposed here</p>
                </article>

                <article class="pipe-node role-decision">
                  <p class="pipe-cap">Decision</p>
                  <h4>Portfolio optimizer</h4>
                  <p class="pipe-sub">weights \(w_t\)</p>
                </article>
              </div>

              <svg class="pipe-overlay" viewBox="0 0 1000 210" preserveAspectRatio="none" aria-hidden="true">
                <defs>
                  <marker id="pipe-arrow-c" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                    <path d="M0,0 L10,5 L0,10 z" fill="#2f3d50"></path>
                  </marker>
                  <marker id="pipe-arc-c" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                    <path d="M0,0 L10,5 L0,10 z" fill="#7a6245"></path>
                  </marker>
                </defs>
                <path d="M165 92 L245 92" marker-end="url(#pipe-arrow-c)"></path>
                <path d="M365 92 L445 92" marker-end="url(#pipe-arrow-c)"></path>
                <path d="M565 92 L645 92" marker-end="url(#pipe-arrow-c)"></path>
                <path d="M765 92 L845 92" marker-end="url(#pipe-arrow-c)"></path>
                <path class="arc" d="M505 132 C 560 188, 640 188, 695 132" marker-end="url(#pipe-arc-c)"></path>
              </svg>
            </figure>

            <div class="mechanism-concrete">
              <p class="mechanism-concrete-title">Concrete projection view</p>
              <div class="projection-mini-wrap">
                <svg class="projection-mini" viewBox="0 0 360 150" role="img" aria-label="Projection sketch">
                  <line x1="36" y1="124" x2="250" y2="124" stroke="#8d99aa" stroke-width="1.4"></line>
                  <line x1="36" y1="124" x2="36" y2="24" stroke="#8d99aa" stroke-width="1.4"></line>
                  <polygon points="108,34 250,34 250,124 156,124" fill="#eef5ef"></polygon>
                  <line x1="108" y1="34" x2="156" y2="124" stroke="#40634d" stroke-width="2" stroke-dasharray="7 5"></line>
                  <line x1="72" y1="110" x2="198" y2="48" stroke="#b13f35" stroke-width="2.6"></line>
                  <line x1="72" y1="110" x2="128" y2="98" stroke="#1f2c3a" stroke-width="2.6"></line>
                  <circle cx="72" cy="110" r="3.8" fill="#1f2c3a"></circle>
                  <circle cx="128" cy="98" r="3.4" fill="#1f2c3a"></circle>
                  <text x="204" y="46" font-size="10.5" fill="#b13f35">raw step</text>
                  <text x="132" y="96" font-size="10.5" fill="#1f2c3a">projected step</text>
                </svg>
                <div class="projection-mini-math">
                  \[
                  g_{\mathrm{proj}}=\arg\min_g\lVert g-g_{\mathrm{raw}}\rVert_2^2
                  \;\text{s.t.}\;
                  \langle g,a_t\rangle \ge 0
                  \]
                </div>
              </div>
              <p class="mechanism-concrete-note">Operational reading: keep the closest update that stays inside the risk budget boundary.</p>
            </div>
          </article>
        </div>
      </section>

      <section class="section" id="workspace" aria-label="Interactive validation workspace">
        <h2>2. Deployment Decision Dashboard</h2>
        <p class="section-note">Read top to bottom. Each plot answers one deployment question.</p>

        <div class="experiment-layout">
          <aside class="control-panel">
            <article class="protocol-board">
              <h3>Modes</h3>
              <div class="preset-row mode-row">
                <button id="apply-quick" data-preset="quick_check" class="btn btn-ghost" type="button">Quick</button>
                <button id="apply-proposal" data-preset="proposal_like" class="btn btn-ghost" type="button">Default</button>
                <button id="apply-stress" data-preset="stress_heavy" class="btn btn-ghost" type="button">Stress+</button>
              </div>
              <p id="mode-readout" class="mode-readout"></p>
            </article>

            <div class="control-stack">
              <article class="focus-panel" aria-label="Strategy focus selector">
                <h3>Strategy</h3>
                <div class="focus-grid">
                  <button id="focus-all" data-focus="all" class="focus-btn active" type="button">All</button>
                  <button id="focus-naive" data-focus="naive" class="focus-btn" type="button">Naive</button>
                  <button id="focus-anchor" data-focus="anchor" class="focus-btn" type="button">Replay</button>
                  <button id="focus-proj" data-focus="anchor_proj" class="focus-btn" type="button">Hybrid</button>
                </div>
              </article>

              <article class="component-panel" aria-label="Constraint toggle interface">
                <h3>Constraint</h3>
                <label class="switch-row" for="toggle-anchor">
                  <span>Anchor fixtures</span>
                  <input id="toggle-anchor" type="checkbox" checked />
                </label>
                <label class="switch-row" for="toggle-projection">
                  <span>Projection gate</span>
                  <input id="toggle-projection" type="checkbox" checked />
                </label>
              </article>

              <details class="advanced-panel">
                <summary>Advanced knobs</summary>
                <form id="config-form" class="knob-grid">
                  <label>
                    Anchor weight
                    <input name="anchorBeta" type="number" step="0.01" />
                  </label>
                  <label>
                    Stress frequency
                    <input name="pStress" type="number" step="0.01" />
                  </label>
                  <label>
                    Update steps
                    <input name="steps" type="number" step="1" />
                  </label>
                  <label>
                    Seed
                    <input name="seed" type="number" step="1" />
                  </label>
                </form>
              </details>

              <div class="action-row">
                <button id="run-demo" class="btn btn-primary" type="button">Run Demo</button>
                <button id="reset-form" class="btn btn-ghost" type="button">Reset</button>
              </div>
            </div>

            <div class="run-status">
              <p id="status-line">Ready.</p>
              <div class="progress-track"><div id="progress-fill"></div></div>
            </div>
          </aside>

          <div class="results-panel">
            <article id="decision-card" class="decision-card"></article>

            <div id="impact-kpis" class="kpi-row"></div>

            <div class="plot-stack">
              <article class="chart-card">
                <h3>Q1. Equity Through Regimes</h3>
                <p class="plot-caption">Same market path, same costs. Read stress windows first.</p>
                <canvas id="pnl-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="pnl-reading"></p>
              </article>

              <article class="chart-card">
                <h3>Q2. Drawdown and Recovery</h3>
                <p class="plot-caption">Compare drawdown depth and recovery speed after shocks.</p>
                <canvas id="drawdown-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="drawdown-reading"></p>
              </article>

              <article class="chart-card">
                <h3>Q3. Allocation vs Turnover</h3>
                <p class="plot-caption">Risk sleeve and turnover path for each strategy.</p>
                <canvas id="allocation-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="allocation-reading"></p>
              </article>

              <article class="chart-card">
                <h3>Q4. Regime Sharpe</h3>
                <p class="plot-caption">Risk-adjusted return by calm, volatile, stress, and shift regimes.</p>
                <canvas id="regime-risk-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="regime-risk-reading"></p>
              </article>

              <article class="chart-card chart-card-wide">
                <h3>Q5. Portfolio Policy View</h3>
                <p class="plot-caption">Calm vs stress risky allocation for each strategy.</p>
                <canvas id="portfolio-state-chart" class="chart-canvas chart-canvas-short"></canvas>
                <p class="chart-reading" id="portfolio-state-reading"></p>
              </article>
            </div>
          </div>
        </div>
      </section>

      <section class="section" id="takeaway-section">
        <h2>3. Deploy Path</h2>

        <figure class="synthesis-diagram" aria-label="End to end deployment pathway">
          <div class="syn-node">LLM stream</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node">Anchor fixture</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node proposed">Projection-gated update</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node">Fixed optimizer</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node">Release decision</div>
        </figure>

        <article id="takeaway" class="takeaway"></article>
      </section>
    </main>

    <footer class="footer">
      <div class="shell footer-inner">
        <a href="#top" class="inline-link">Back to top</a>
      </div>
    </footer>

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>
    <script>
      window.addEventListener("load", () => {
        if (!window.renderMathInElement) {
          return;
        }
        window.renderMathInElement(document.body, {
          delimiters: [
            { left: "\\[", right: "\\]", display: true },
            { left: "\\(", right: "\\)", display: false },
          ],
          throwOnError: false,
          strict: "ignore",
        });
      });
    </script>
    <script type="module" src="./src/main.js"></script>
  </body>
</html>
