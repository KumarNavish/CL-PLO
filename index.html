<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CL-PLO Spine | Stable Transformer Updates for Portfolio Decisions</title>
    <link rel="stylesheet" href="./coreline.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" />
  </head>
  <body>
    <header class="executive" id="top">
      <div class="shell">
        <article class="hero-insight" aria-label="High-signal decision summary">
          <p class="hero-kicker">CL-PLO Decision Spine</p>
          <h1>In live portfolios, the update rule is the risk control surface.</h1>

          <div class="hero-grid">
            <article class="hero-mini">
              <p class="hero-mini-title">Core problem</p>
              <p>Drift-only LLM updates fit calm tape and forget stress behavior exactly when allocation risk is highest.</p>
            </article>
            <article class="hero-mini">
              <p class="hero-mini-title">What stays fixed</p>
              <p>Transformer backbone and optimizer constraints are frozen; only the adapter update operator changes.</p>
            </article>
            <article class="hero-mini">
              <p class="hero-mini-title">What this page proves</p>
              <p>Under identical data and optimizer settings, projection-gated updates keep stress retention and drawdown control.</p>
            </article>
          </div>

          <div class="hero-method-row" aria-label="Three strategy one-line summaries">
            <p><span>A</span>Naive step: fastest fit, zero memory protection.</p>
            <p><span>B</span>Replay mix: adds memory pressure, no hard safety boundary.</p>
            <p><span>C</span>Replay + projection: keeps adaptation inside an anchor-safe update region.</p>
          </div>

          <div class="hero-result">
            <p class="hero-signal">
              <strong>Default release signal:</strong> projection-gated updates deliver +97.1% stress retention and +34.1 pp drawdown lift versus naive.
            </p>
            <figure class="hero-figure" aria-label="Decisive strategy comparison signal">
              <img src="./assets/validation_wide.png" alt="Validation figure: constrained update dominates stress retention and drawdown control" />
              <figcaption>One-screen release check used before promotion.</figcaption>
            </figure>
          </div>
        </article>
      </div>
    </header>

    <main class="shell flow">
      <section class="section" id="strategies">
        <h2>1. Three Strategy Mechanisms</h2>
        <div class="pipeline-legend" aria-label="pipeline role legend">
          <span><i class="swatch data"></i>Data stream</span>
          <span><i class="swatch memory"></i>Anchor memory</span>
          <span><i class="swatch update"></i>Update operator</span>
          <span><i class="swatch decision"></i>Decision layer</span>
        </div>

        <div class="strategy-grid">
          <article class="strategy-card">
            <header>
              <p class="method-tag">A · Baseline</p>
              <h3>Naive Online Update</h3>
            </header>
            <div class="pipeline-layout">
              <svg class="pipeline-svg" viewBox="0 0 980 236" role="img" aria-label="Naive strategy pipeline">
                <defs>
                  <marker id="arrow-a" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                    <path d="M0,0 L8,4 L0,8 z" fill="#1f1f1f" />
                  </marker>
                </defs>

                <rect x="22" y="88" width="152" height="76" class="node data" />
                <text x="98" y="116" text-anchor="middle">Stream</text>
                <text x="98" y="138" text-anchor="middle">drift batch</text>

                <line x1="174" y1="126" x2="202" y2="126" marker-end="url(#arrow-a)" class="link" />

                <rect x="210" y="88" width="164" height="76" class="node frozen" />
                <text x="292" y="116" text-anchor="middle">Frozen Backbone</text>
                <text x="292" y="138" text-anchor="middle">backbone + optimizer</text>

                <line x1="374" y1="126" x2="402" y2="126" marker-end="url(#arrow-a)" class="link" />

                <rect x="410" y="24" width="154" height="64" class="node memory off" />
                <text x="487" y="50" text-anchor="middle">Anchor Fixture</text>
                <text x="487" y="70" text-anchor="middle">disabled</text>
                <line x1="487" y1="88" x2="487" y2="100" class="link link-dashed" />
                <line x1="479" y1="93" x2="495" y2="108" class="link link-dashed" />
                <line x1="495" y1="93" x2="479" y2="108" class="link link-dashed" />

                <rect x="410" y="88" width="154" height="76" class="node update risk" />
                <text x="487" y="116" text-anchor="middle">Update Operator</text>
                <text x="487" y="138" text-anchor="middle">raw drift step (Eq A)</text>

                <line x1="564" y1="126" x2="592" y2="126" marker-end="url(#arrow-a)" class="link" />

                <rect x="600" y="88" width="172" height="76" class="node decision" />
                <text x="686" y="116" text-anchor="middle">Decision Layer</text>
                <text x="686" y="138" text-anchor="middle">forecast to weights</text>

                <line x1="772" y1="126" x2="800" y2="126" marker-end="url(#arrow-a)" class="link" />

                <rect x="808" y="88" width="150" height="76" class="node rail" />
                <text x="883" y="116" text-anchor="middle">Output</text>
                <text x="883" y="138" text-anchor="middle">high drift fit, weak stress</text>
              </svg>

              <aside class="pipeline-equation">
                <p class="math-tag prior">Prior work · Eq A</p>
                <div class="math-block compact">
                  \[
                  \theta_{t+1}=\theta_t-\eta_t g_{d,t}
                  \]
                </div>
                <p class="math-meaning"><strong>Operational meaning:</strong> fastest adaptation path, no memory safeguard against stress forgetting.</p>
              </aside>
            </div>
          </article>

          <article class="strategy-card">
            <header>
              <p class="method-tag">B · Baseline</p>
              <h3>Replay-Regularized</h3>
            </header>
            <div class="pipeline-layout">
              <svg class="pipeline-svg" viewBox="0 0 980 236" role="img" aria-label="Replay strategy pipeline">
                <defs>
                  <marker id="arrow-b" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                    <path d="M0,0 L8,4 L0,8 z" fill="#1f1f1f" />
                  </marker>
                </defs>

                <rect x="22" y="88" width="152" height="76" class="node data" />
                <text x="98" y="116" text-anchor="middle">Stream</text>
                <text x="98" y="138" text-anchor="middle">drift batch</text>

                <line x1="174" y1="126" x2="202" y2="126" marker-end="url(#arrow-b)" class="link" />

                <rect x="210" y="88" width="164" height="76" class="node frozen" />
                <text x="292" y="116" text-anchor="middle">Frozen Backbone</text>
                <text x="292" y="138" text-anchor="middle">backbone + optimizer</text>

                <line x1="374" y1="126" x2="402" y2="126" marker-end="url(#arrow-b)" class="link" />

                <rect x="410" y="24" width="154" height="64" class="node memory" />
                <text x="487" y="50" text-anchor="middle">Anchor Fixture</text>
                <text x="487" y="70" text-anchor="middle">stress memory replay</text>
                <line x1="487" y1="88" x2="487" y2="100" marker-end="url(#arrow-b)" class="link" />

                <rect x="410" y="88" width="154" height="76" class="node update" />
                <text x="487" y="116" text-anchor="middle">Update Operator</text>
                <text x="487" y="138" text-anchor="middle">drift + replay mix (Eq B)</text>

                <line x1="564" y1="126" x2="592" y2="126" marker-end="url(#arrow-b)" class="link" />

                <rect x="600" y="88" width="172" height="76" class="node decision" />
                <text x="686" y="116" text-anchor="middle">Decision Layer</text>
                <text x="686" y="138" text-anchor="middle">forecast to weights</text>

                <line x1="772" y1="126" x2="800" y2="126" marker-end="url(#arrow-b)" class="link" />

                <rect x="808" y="88" width="150" height="76" class="node rail" />
                <text x="883" y="116" text-anchor="middle">Output</text>
                <text x="883" y="138" text-anchor="middle">memory helps, no hard gate</text>
              </svg>

              <aside class="pipeline-equation">
                <p class="math-tag prior">Prior work · Eq B</p>
                <div class="math-block compact">
                  \[
                  \theta_{t+1}=\theta_t-\eta_t\left(g_{d,t}+\beta_t g_{a,t}\right)
                  \]
                </div>
                <p class="math-meaning"><strong>Operational meaning:</strong> replay resists forgetting, but conflicting gradients can still pass through.</p>
              </aside>
            </div>
          </article>

          <article class="strategy-card">
            <header>
              <p class="method-tag proposed">C · Proposed</p>
              <h3>Replay + Projection Gate</h3>
            </header>
            <div class="pipeline-layout">
              <svg class="pipeline-svg" viewBox="0 0 980 236" role="img" aria-label="Constrained strategy pipeline">
                <defs>
                  <marker id="arrow-c" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                    <path d="M0,0 L8,4 L0,8 z" fill="#1f1f1f" />
                  </marker>
                </defs>

                <rect x="22" y="88" width="152" height="76" class="node data" />
                <text x="98" y="116" text-anchor="middle">Stream</text>
                <text x="98" y="138" text-anchor="middle">drift batch</text>

                <line x1="174" y1="126" x2="202" y2="126" marker-end="url(#arrow-c)" class="link" />

                <rect x="210" y="88" width="164" height="76" class="node frozen" />
                <text x="292" y="116" text-anchor="middle">Frozen Backbone</text>
                <text x="292" y="138" text-anchor="middle">backbone + optimizer</text>

                <line x1="374" y1="126" x2="402" y2="126" marker-end="url(#arrow-c)" class="link" />

                <rect x="410" y="24" width="154" height="64" class="node memory" />
                <text x="487" y="50" text-anchor="middle">Anchor Fixture</text>
                <text x="487" y="70" text-anchor="middle">stress memory replay</text>
                <line x1="487" y1="88" x2="487" y2="100" marker-end="url(#arrow-c)" class="link" />

                <rect x="410" y="88" width="154" height="76" class="node update proposed" />
                <text x="487" y="116" text-anchor="middle">Update Operator</text>
                <text x="487" y="138" text-anchor="middle">projected replay step (Eq C)</text>

                <rect x="574" y="106" width="44" height="40" class="gate" />
                <text x="596" y="122" text-anchor="middle" class="gate-text">Projection</text>
                <text x="596" y="138" text-anchor="middle" class="gate-text">Gate</text>

                <line x1="618" y1="126" x2="646" y2="126" marker-end="url(#arrow-c)" class="link" />

                <rect x="654" y="88" width="168" height="76" class="node decision" />
                <text x="738" y="116" text-anchor="middle">Decision Layer</text>
                <text x="738" y="138" text-anchor="middle">forecast to weights</text>

                <line x1="822" y1="126" x2="850" y2="126" marker-end="url(#arrow-c)" class="link" />

                <rect x="858" y="88" width="100" height="76" class="node rail proposed" />
                <text x="908" y="116" text-anchor="middle">Output</text>
                <text x="908" y="138" text-anchor="middle">stable + adaptive</text>
              </svg>

              <aside class="pipeline-equation">
                <p class="math-tag proposed">Proposed here · Eq C</p>
                <div class="math-block compact">
                  \[
                  \tilde g_t=\Pi_{\mathcal{H}_t}(g_{d,t}),
                  \qquad
                  \theta_{t+1}=\theta_t-\eta_t\left(\tilde g_t+\beta_t g_{a,t}\right)
                  \]
                </div>
                <p class="math-meaning"><strong>Operational meaning:</strong> the gate keeps every drift step inside anchor-safe geometry before allocation updates.</p>
              </aside>
            </div>
          </article>
        </div>
      </section>

      <section class="section" id="objects">
        <h2>2. Concrete Anchors and Projection</h2>

        <div class="anchor-gallery" aria-label="Concrete anchor fixtures as real artifacts">
          <figure class="anchor-item">
            <img src="./assets/anchors/liquidity_spread.svg" alt="Bid-ask spread shock artifact" loading="lazy" />
            <figcaption>Liquidity freeze spread shock.</figcaption>
          </figure>
          <figure class="anchor-item">
            <img src="./assets/anchors/gap_open_session.svg" alt="Gap-open session artifact" loading="lazy" />
            <figcaption>Gap-open tape after overnight shock.</figcaption>
          </figure>
          <figure class="anchor-item">
            <img src="./assets/anchors/volatility_spike.svg" alt="Volatility spike artifact" loading="lazy" />
            <figcaption>Volatility regime jump window.</figcaption>
          </figure>
          <figure class="anchor-item">
            <img src="./assets/anchors/correlation_breakdown.svg" alt="Correlation breakdown heatmap artifact" loading="lazy" />
            <figcaption>Correlation breakdown map snapshot.</figcaption>
          </figure>
          <figure class="anchor-item">
            <img src="./assets/anchors/sector_cascade.svg" alt="Sector cascade drawdown artifact" loading="lazy" />
            <figcaption>Sector cascade drawdown trajectory.</figcaption>
          </figure>
          <figure class="anchor-item">
            <img src="./assets/anchors/funding_stress.svg" alt="Funding stress spread artifact" loading="lazy" />
            <figcaption>Funding stress spread proxy.</figcaption>
          </figure>
        </div>

        <div class="projection-wrap">
          <figure class="projection-figure" aria-label="Projection geometry">
            <svg viewBox="0 0 760 292" class="projection-svg" role="img">
              <defs>
                <marker id="proj-arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                  <path d="M0,0 L8,4 L0,8 z" fill="#1d1d1d" />
                </marker>
                <marker id="raw-arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                  <path d="M0,0 L8,4 L0,8 z" fill="#a33232" />
                </marker>
              </defs>

              <rect x="0" y="0" width="760" height="292" fill="#ffffff" />
              <polygon points="368,28 732,28 732,264 532,264" class="halfspace" />
              <line x1="368" y1="28" x2="532" y2="264" class="constraint-line" />
              <text x="548" y="250" class="proj-label">safe half-space H_t</text>

              <line x1="112" y1="236" x2="674" y2="104" class="raw-vector" marker-end="url(#raw-arrow)" />
              <text x="596" y="90" class="proj-label raw-label">raw update g_d,t</text>

              <line x1="112" y1="236" x2="486" y2="160" class="proj-vector" marker-end="url(#proj-arrow)" />
              <text x="494" y="147" class="proj-label">projected update g_tilde,t</text>
            </svg>
          </figure>

          <aside class="projection-math-card" aria-label="Projection equation">
            <p class="math-tag proposed">Proposed here</p>
            <div class="math-block projection-math">
              \[
              \begin{aligned}
              \tilde g_t
              &=\arg\min_{v\in\mathcal{H}_t}\lVert v-g_{d,t}\rVert_2^2\\
              \mathcal{H}_t
              &=\{v:\langle v,g_{a,t}\rangle\ge-\varepsilon_t\}
              \end{aligned}
              \]
            </div>
            <p class="math-meaning"><strong>Operational meaning:</strong> replace the raw step with the nearest feasible update inside the safety half-space.</p>
          </aside>
        </div>

        <p class="object-note">Anchor fixture = stored stress artifacts replayed at every update. Projection = closest feasible update that respects anchor-memory safety.</p>
      </section>

      <section class="section" id="math">
        <h2>3. Bounded Math (Prior vs Proposed)</h2>

        <div class="math-grid">
          <article class="math-card">
            <p class="math-tag prior">Prior work</p>
            <h3>Constrained portfolio decision</h3>
            <div class="math-block">
              \[
              \begin{aligned}
              w_t^\star
              &=\arg\max_{w\in\mathcal{W}}
              \Big(
              \mu_t^\top w
              -\frac{\gamma}{2}w^\top\Sigma_t w
              -\lambda_{\mathrm{tc}}\lVert w-w_{t-1}\rVert_1
              \Big)
              \end{aligned}
              \]
            </div>
            <p class="math-meaning"><strong>Operational meaning:</strong> convert forecasts to tradable weights under fixed risk and turnover limits.</p>
          </article>

          <article class="math-card">
            <p class="math-tag prior">Prior work</p>
            <h3>Replay-regularized adapter update</h3>
            <div class="math-block">
              \[
              \begin{aligned}
              \theta_{t+1}
              &=\theta_t-\eta_t\nabla_\theta
              \Big(
              \mathcal{L}_{\mathrm{drift},t}(\theta_t)
              +\beta_t\,\mathcal{L}_{\mathrm{anchor},t}(\theta_t)
              \Big)
              \end{aligned}
              \]
            </div>
            <p class="math-meaning"><strong>Operational meaning:</strong> adapt to current drift while continuously replaying stress anchors.</p>
          </article>

          <article class="math-card">
            <p class="math-tag proposed">Proposed here</p>
            <h3>Projected safe adapter update</h3>
            <div class="math-block">
              \[
              \begin{aligned}
              \tilde g_t
              &=\arg\min_v\lVert v-g_{d,t}\rVert_2^2\\
              \text{s.t.}\quad
              \langle v,g_{a,t}\rangle &\ge -\varepsilon_t\\
              \theta_{t+1}
              &=\theta_t-\eta_t\left(\tilde g_t+\beta_t g_{a,t}\right)
              \end{aligned}
              \]
            </div>
            <p class="math-meaning"><strong>Operational meaning:</strong> execute the closest drift step that does not violate anchor-memory safety.</p>
          </article>
        </div>
      </section>

      <section class="section" id="workspace" aria-label="Interactive validation workspace">
        <h2>4. Interactive Validation Workspace</h2>

        <div class="experiment-layout">
          <aside class="control-panel">
            <article class="protocol-board">
              <h3>Modes</h3>
              <div class="mode-grid">
                <article class="mode-card" data-mode-card="quick_check"><h4>Quick</h4><p>Fast directional check.</p></article>
                <article class="mode-card" data-mode-card="proposal_like"><h4>Default</h4><p>Deployment-like baseline.</p></article>
                <article class="mode-card" data-mode-card="stress_heavy"><h4>Stress+</h4><p>Adversarial release gate.</p></article>
              </div>
              <p id="mode-readout" class="mode-readout"></p>
            </article>

            <div class="control-stack">
              <div class="preset-row">
                <button id="apply-quick" data-preset="quick_check" class="btn btn-ghost" type="button">Quick</button>
                <button id="apply-proposal" data-preset="proposal_like" class="btn btn-ghost" type="button">Default</button>
                <button id="apply-stress" data-preset="stress_heavy" class="btn btn-ghost" type="button">Stress+</button>
              </div>

              <form id="config-form" class="knob-grid">
                <label>
                  Anchor weight
                  <input name="anchorBeta" type="number" step="0.01" />
                </label>
                <label>
                  LoRA rank
                  <input name="loraRank" type="number" step="1" />
                </label>
                <label>
                  Stress frequency
                  <input name="pStress" type="number" step="0.01" />
                </label>
                <label>
                  Update steps
                  <input name="steps" type="number" step="1" />
                </label>
                <label>
                  Seed
                  <input name="seed" type="number" step="1" />
                </label>
              </form>

              <div class="action-row">
                <button id="run-demo" class="btn btn-primary" type="button">Run Demo</button>
                <button id="reset-form" class="btn btn-ghost" type="button">Reset</button>
                <button id="export-run" class="btn btn-ghost" type="button">Export JSON</button>
              </div>
            </div>

            <div class="run-status">
              <p id="status-line">Ready.</p>
              <div class="progress-track"><div id="progress-fill"></div></div>
            </div>
          </aside>

          <div class="results-panel">
            <div class="decision-panels">
              <article id="expectation-check" class="expectation-check"></article>
              <article id="decision-card" class="decision-card"></article>
            </div>

            <div id="impact-kpis" class="kpi-row"></div>

            <div class="plot-stack">
              <article class="chart-card">
                <h3>Retention vs Stress Impact</h3>
                <p class="plot-caption"><strong>Shows:</strong> stress-retention gain and drawdown lift versus naive.<br /><strong>Read:</strong> convincing signal is constrained > replay on both bars.</p>
                <canvas id="impact-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="impact-reading"></p>
              </article>

              <article class="chart-card">
                <h3>Equity Curve with Stress Regimes</h3>
                <p class="plot-caption"><strong>Shows:</strong> full equity path with shaded stress windows.<br /><strong>Read:</strong> look for shallower stress drawdowns without drift collapse.</p>
                <canvas id="equity-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="equity-reading"></p>
              </article>

              <article class="chart-card">
                <h3>Regime Split (Drift vs Stress)</h3>
                <p class="plot-caption"><strong>Shows:</strong> mean returns split by drift and stress regimes.<br /><strong>Read:</strong> method quality is explicit trade-off, not hidden averaging.</p>
                <canvas id="regime-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="regime-reading"></p>
              </article>
            </div>

            <article class="table-wrap">
              <h3>Method Scoreboard</h3>
              <p class="table-guide">Use ranking for promotion decisions only after repeated Stress+ seed checks.</p>
              <table id="method-table" class="method-table"></table>
            </article>
          </div>
        </div>
      </section>

      <section class="section" id="takeaway-section">
        <h2>5. End-to-End Decision Path</h2>

        <figure class="synthesis-diagram" aria-label="End to end deployment pathway">
          <div class="syn-node">LLM stream</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node">Anchor fixture</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node proposed">Projection-gated update</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node">Fixed optimizer</div>
          <div class="syn-arrow">→</div>
          <div class="syn-node">Release decision</div>
        </figure>

        <article id="takeaway" class="takeaway"></article>
      </section>
    </main>

    <footer class="footer">
      <div class="shell footer-inner">
        <a href="#top" class="inline-link">Back to top</a>
      </div>
    </footer>

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>
    <script>
      window.addEventListener("load", () => {
        if (!window.renderMathInElement) {
          return;
        }
        window.renderMathInElement(document.body, {
          delimiters: [
            { left: "\\[", right: "\\]", display: true },
            { left: "\\(", right: "\\)", display: false },
          ],
          throwOnError: false,
          strict: "ignore",
        });
      });
    </script>
    <script type="module" src="./src/main.js"></script>
  </body>
</html>
