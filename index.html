<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CL-PLO | Theory-First Decision Artifact</title>
    <link rel="stylesheet" href="./coreline.css" />
  </head>
  <body>
    <header class="hero">
      <div class="shell">
        <nav class="topbar">
          <a class="toplink" href="./strategy-comparison.html">Strategy Comparison</a>
          <span class="version">Coreline V4 Â· theory-first CL-PLO</span>
        </nav>

        <p class="eyebrow">Continual Learning for Portfolio Optimization</p>
        <h1>Theory first: constrain adaptation so stress behavior is not forgotten.</h1>
        <p class="lead">
          This page is ordered as a technical argument. First: formulation and method mechanics. Second: validation
          runs that confirm or reject what the mechanics predict.
        </p>

        <div class="hero-actions">
          <a class="btn btn-primary" href="#foundations">Read Technical Foundations</a>
          <a class="btn btn-ghost" href="#methods">Inspect Method Pipelines</a>
          <a class="btn btn-ghost" href="#validation">Run Validation Experiment</a>
        </div>
      </div>
    </header>

    <main class="shell">
      <section class="card thesis" aria-label="Core thesis">
        <h2>Core Thesis</h2>
        <p>
          Naive continual updates are adaptation-fast but retention-fragile. Anchor regularization improves retention,
          and projection adds an explicit geometric guardrail against stress-regime forgetting.
        </p>
        <ul>
          <li><strong>What is protected:</strong> stress-regime signal retention and drawdown behavior.</li>
          <li><strong>What is allowed:</strong> drift adaptation in directions that do not violate anchor constraints.</li>
          <li><strong>Deployment rule:</strong> promote only if stress gains survive drawdown and drift-fit tradeoffs.</li>
        </ul>
      </section>

      <section id="foundations" class="card" aria-label="Technical foundations">
        <div class="section-head">
          <h2>1. Problem Formulation and Assumptions</h2>
          <p>Define the mechanism before looking at evidence.</p>
        </div>

        <div class="foundation-grid">
          <article>
            <h3>Optimization Layer</h3>
            <pre>w_t = arg min_w -mu_hat_t^T w + gamma * w^T Sigma_hat_t w + lambda_tc * TC(w, w_{t-1})
subject to risk and drawdown constraints</pre>
            <p>
              Portfolio construction is fixed across methods. The comparison only changes how the PEFT adapter update
              is computed under drift and stress conditions.
            </p>
          </article>

          <article>
            <h3>Learning Assumptions</h3>
            <ul>
              <li>Market regimes drift over time and occasionally enter stress states.</li>
              <li>A frozen backbone with LoRA adapters is sufficient for online adaptation.</li>
              <li>Stress anchor samples approximate behavior that must not regress.</li>
              <li>Drawdown and turnover realism are non-negotiable deployment filters.</li>
            </ul>
          </article>

          <article>
            <h3>Expected Ordering Before Tests</h3>
            <ol>
              <li>Naive: best short-horizon drift fit, weakest stress retention.</li>
              <li>Anchor: intermediate retention and intermediate adaptation.</li>
              <li>Projection: strongest stress retention, highest drift-fit penalty risk.</li>
            </ol>
          </article>
        </div>
      </section>

      <section id="methods" class="card" aria-label="Method theory and pipelines">
        <div class="section-head">
          <h2>2. Method Theory and Pipeline Diagrams</h2>
          <p>Each method is specified by objective, constraints, and update geometry.</p>
        </div>

        <div class="method-theory-grid">
          <article class="method-theory">
            <h3>Naive LoRA Update (Baseline)</h3>
            <ul class="method-meta">
              <li><strong>Objective:</strong> minimize current drift loss only.</li>
              <li><strong>Constraint:</strong> no retention constraint in gradient space.</li>
              <li><strong>Preserves:</strong> short-term fit to current regime.</li>
              <li><strong>Allows change:</strong> all adapter directions, including stress-critical ones.</li>
            </ul>
            <pre>g = grad L_drift
theta_{t+1} = theta_t - eta * g</pre>
            <div class="pipeline" aria-label="Naive method pipeline">
              <span class="node input">Drift batch</span><span class="arrow">-&gt;</span>
              <span class="node update">Adapter gradient</span><span class="arrow">-&gt;</span>
              <span class="node update">LoRA update</span><span class="arrow">-&gt;</span>
              <span class="node decision">Portfolio optimizer</span><span class="arrow">-&gt;</span>
              <span class="node decision">Weights</span>
            </div>
            <p class="method-ref">
              References:
              <a href="https://arxiv.org/abs/2106.09685" target="_blank" rel="noreferrer">LoRA (Hu et al., 2022)</a>,
              <a href="https://dl.acm.org/doi/10.1145/2638548" target="_blank" rel="noreferrer">Online Portfolio Selection Survey</a>.
            </p>
          </article>

          <article class="method-theory">
            <h3>Anchor-Regularized Update</h3>
            <ul class="method-meta">
              <li><strong>Objective:</strong> fit drift while penalizing regression on anchor stress samples.</li>
              <li><strong>Constraint:</strong> soft retention via anchor weight beta.</li>
              <li><strong>Preserves:</strong> part of stress behavior through weighted replay.</li>
              <li><strong>Allows change:</strong> directions that trade off drift fit and retention loss.</li>
            </ul>
            <pre>L = L_drift + beta * L_anchor
g = grad L
theta_{t+1} = theta_t - eta * g</pre>
            <div class="pipeline" aria-label="Anchor method pipeline">
              <span class="node input">Drift batch</span><span class="arrow">+</span>
              <span class="node memory">Anchor buffer</span><span class="arrow">-&gt;</span>
              <span class="node update">Weighted loss</span><span class="arrow">-&gt;</span>
              <span class="node update">LoRA update</span><span class="arrow">-&gt;</span>
              <span class="node decision">Portfolio optimizer</span>
            </div>
            <p class="method-ref">
              References:
              <a href="https://openreview.net/forum?id=Hkf2_sC5FX" target="_blank" rel="noreferrer">A-GEM (Chaudhry et al., 2019)</a>,
              <a href="https://proceedings.neurips.cc/paper/2012/hash/5d44ee6f2c3f71b73125876103c8f6c4-Abstract.html" target="_blank" rel="noreferrer">Online Constraints (Mahdavi et al., 2012)</a>.
            </p>
          </article>

          <article class="method-theory">
            <h3>Anchor + Projection (Proposed)</h3>
            <ul class="method-meta">
              <li><strong>Objective:</strong> maximize drift adaptation subject to no harmful anchor interference.</li>
              <li><strong>Constraint:</strong> hard gradient-space projection against anchor direction.</li>
              <li><strong>Preserves:</strong> anchor-consistent stress response by construction.</li>
              <li><strong>Allows change:</strong> drift-aligned directions that satisfy projection gate.</li>
            </ul>
            <pre>g_tilde = arg min_g 0.5 * ||g - g_drift||^2
subject to &lt;g, g_anchor&gt; >= -eps

theta_{t+1} = theta_t - eta * g_tilde</pre>
            <div class="pipeline" aria-label="Projection method pipeline">
              <span class="node input">Drift gradient</span><span class="arrow">+</span>
              <span class="node memory">Anchor gradient</span><span class="arrow">-&gt;</span>
              <span class="node gate">Projection gate</span><span class="arrow">-&gt;</span>
              <span class="node update">Projected update</span><span class="arrow">-&gt;</span>
              <span class="node decision">Portfolio optimizer</span>
            </div>
            <p class="method-ref">
              References:
              <a href="https://openreview.net/forum?id=Hkf2_sC5FX" target="_blank" rel="noreferrer">A-GEM</a>,
              <a href="https://arxiv.org/abs/2405.13383" target="_blank" rel="noreferrer">Gradient Projection for Continual PEFT</a>,
              <a href="https://web.stanford.edu/~boyd/papers/pdf/cvx_portfolio.pdf" target="_blank" rel="noreferrer">Convex Portfolio Control</a>.
            </p>
          </article>
        </div>
      </section>

      <section id="validation" class="card" aria-label="Validation experiments">
        <div class="section-head">
          <h2>3. Validation Experiments (Evidence)</h2>
          <p>Run after theory review. Results are interpreted against prior expectations.</p>
        </div>

        <article id="expectation-check" class="expectation-check"></article>

        <div class="control-stack">
          <div class="preset-row">
            <button id="apply-quick" class="btn btn-ghost" type="button">Quick</button>
            <button id="apply-proposal" class="btn btn-ghost" type="button">Default</button>
            <button id="apply-stress" class="btn btn-ghost" type="button">Stress+</button>
          </div>

          <form id="config-form" class="knob-grid">
            <label>Update steps<input name="steps" type="number" step="1" /></label>
            <label>Anchor weight<input name="anchorBeta" type="number" step="0.01" /></label>
            <label>Stress frequency<input name="pStress" type="number" step="0.01" /></label>
            <label>LoRA rank<input name="loraRank" type="number" step="1" /></label>
            <label>Seed<input name="seed" type="number" step="1" /></label>
          </form>

          <div class="action-row">
            <button id="run-demo" class="btn btn-primary" type="button">Run Validation</button>
            <button id="reset-form" class="btn btn-ghost" type="button">Reset</button>
            <button id="export-run" class="btn btn-ghost" type="button">Export JSON</button>
          </div>
        </div>

        <div class="run-status">
          <p id="status-line">Ready.</p>
          <div class="progress-track"><div id="progress-fill"></div></div>
        </div>

        <article id="decision-card" class="decision-card"></article>

        <div id="impact-kpis" class="kpi-row"></div>

        <div class="chart-grid">
          <article>
            <h3>Impact vs Naive</h3>
            <canvas id="impact-chart" class="chart-canvas"></canvas>
          </article>
          <article>
            <h3>Equity Curves</h3>
            <canvas id="equity-chart" class="chart-canvas"></canvas>
          </article>
        </div>

        <article class="table-wrap">
          <h3>Method Scoreboard (Validation Output)</h3>
          <table id="method-table" class="method-table"></table>
        </article>

        <article id="takeaway" class="takeaway"></article>
      </section>
    </main>

    <footer class="footer">
      <p>Principle: theory defines expectations; experiments test them.</p>
    </footer>

    <script type="module" src="./src/main.js"></script>
  </body>
</html>
