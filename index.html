<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CL-PLO Spine | Stable Transformer Updates for Portfolio Decisions</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./coreline.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" />
  </head>
  <body>
    <header class="executive" id="top">
      <div class="shell">
        <article class="hero-insight" aria-label="Decision summary">
          <p class="hero-kicker">CL-PLO Decision Spine</p>
          <h1>When market regimes shift, the update rule decides whether a transformer portfolio survives.</h1>

          <div class="hero-grid">
            <article class="hero-mini">
              <p class="hero-mini-title">Core Problem</p>
              <p>Pure drift updates chase recent flow and forget stress behavior needed in live trading.</p>
            </article>
            <article class="hero-mini">
              <p class="hero-mini-title">What Stays Fixed</p>
              <p>Transformer backbone, optimizer, and risk limits are fixed across all runs.</p>
            </article>
            <article class="hero-mini">
              <p class="hero-mini-title">What This Page Tests</p>
              <p>Only the updater changes: naive, replay, or replay plus projection gate.</p>
            </article>
          </div>

          <div class="hero-method-row" aria-label="Three strategy one-line summaries">
            <p><span>A</span>Naive: fast adaptation, no stress replay.</p>
            <p><span>B</span>Replay: stress fixtures added to each step.</p>
            <p><span>C</span>Hybrid: replay plus risk-feasible projection.</p>
          </div>

          <div class="hero-result">
            <p class="hero-signal">
              <strong>Decision signal:</strong> hybrid keeps stress retention high while limiting drawdown and turnover.
            </p>
            <article class="hero-proof" aria-label="One-screen check">
              <h3>One-Screen Decision Check</h3>
              <div class="proof-row">
                <span>Naive</span>
                <span class="proof-metric">forgets stress regime</span>
              </div>
              <div class="proof-row">
                <span>Replay</span>
                <span class="proof-metric">retention improves</span>
              </div>
              <div class="proof-row highlight">
                <span>Hybrid</span>
                <span class="proof-metric">retention with risk gate</span>
              </div>
              <p class="proof-note">Run Quick, Default, and Stress+ to verify the same ranking under each regime mix.</p>
            </article>
          </div>
        </article>
      </div>
    </header>

    <main class="shell flow">
      <section class="section" id="strategies">
        <h2>1. Three Strategy Mechanisms</h2>
        <p class="section-note">A live portfolio model has one hard requirement: keep adapting to new flow without erasing behavior learned from stress windows. All three pipelines share the same transformer, same data stream, and same optimizer. Only the update rule changes.</p>

        <div class="notation-strip" aria-label="Notation primer">
          <p><strong>\(x_t\)</strong>: current LLM market batch (tokens plus returns)</p>
          <p><strong>\(A_t\)</strong>: anchor fixture set (stress windows kept in memory)</p>
          <p><strong>\(g_{d,t}\)</strong>: drift gradient from current flow</p>
          <p><strong>\(g_{a,t}\)</strong>: anchor gradient from replay fixtures</p>
          <p><strong>\(w_t\)</strong>: portfolio weights sent to execution</p>
        </div>

        <div class="pipeline-legend" aria-label="Pipeline role legend">
          <span><i class="swatch data"></i>Stream input</span>
          <span><i class="swatch memory"></i>Anchor memory</span>
          <span><i class="swatch update"></i>Update operator</span>
          <span><i class="swatch decision"></i>Decision layer</span>
        </div>

        <div class="mechanism-stack">
          <article class="mechanism-card">
            <header class="mechanism-head">
              <p class="method-tag">A · Prior literature</p>
              <h3>Naive Drift Update</h3>
              <p class="mechanism-intuition">Only the latest batch drives the step. This reacts quickly, but stress fixtures stay idle and retention decays after regime breaks.</p>
            </header>

            <figure class="pipeline-figure" aria-label="Naive strategy pipeline">
              <svg class="pipeline-svg" viewBox="0 0 1240 282" role="img" aria-label="Naive update pipeline">
                <defs>
                  <marker id="arrow-naive" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                    <path d="M0,0 L10,5 L0,10 z" fill="#2f3d50"></path>
                  </marker>
                </defs>

                <rect class="stage-box role-data" x="32" y="86" width="206" height="122" rx="10"></rect>
                <rect class="stage-box role-core" x="272" y="86" width="206" height="122" rx="10"></rect>
                <rect class="stage-box role-memory passive" x="512" y="86" width="206" height="122" rx="10"></rect>
                <rect class="stage-box role-update" x="752" y="86" width="206" height="122" rx="10"></rect>
                <rect class="stage-box role-decision" x="992" y="86" width="206" height="122" rx="10"></rect>

                <line class="flow-arrow" x1="238" y1="147" x2="272" y2="147" marker-end="url(#arrow-naive)"></line>
                <line class="flow-arrow" x1="478" y1="147" x2="512" y2="147" marker-end="url(#arrow-naive)"></line>
                <line class="flow-arrow" x1="718" y1="147" x2="752" y2="147" marker-end="url(#arrow-naive)"></line>
                <line class="flow-arrow" x1="958" y1="147" x2="992" y2="147" marker-end="url(#arrow-naive)"></line>

                <text class="stage-cap" x="50" y="108">STREAM</text>
                <text class="stage-title" x="50" y="136">LLM market batch</text>
                <text class="stage-sub" x="50" y="158">tokens + returns x_t</text>

                <text class="stage-cap" x="290" y="108">FROZEN</text>
                <text class="stage-title" x="290" y="136">Transformer backbone</text>
                <text class="stage-sub" x="290" y="158">encoder + optimizer fixed</text>

                <text class="stage-cap" x="530" y="108">MEMORY</text>
                <text class="stage-title" x="530" y="136">Anchor set A_t</text>
                <text class="stage-sub" x="530" y="158">stored, not replayed</text>

                <text class="stage-cap" x="770" y="108">UPDATE</text>
                <text class="stage-title" x="770" y="136">Drift-only step</text>
                <text class="stage-sub" x="770" y="158">uses only g_d,t</text>

                <text class="stage-cap" x="1010" y="108">DECISION</text>
                <text class="stage-title" x="1010" y="136">Portfolio optimizer</text>
                <text class="stage-sub" x="1010" y="158">emits weights w_t</text>
              </svg>

              <figcaption class="pipeline-formula">
                <p class="pipe-origin prior">Prior work</p>
                <div class="pipe-math">
                  \[
                  \begin{aligned}
                  g_t&=g_{d,t},\\
                  \theta_{t+1}&=\theta_t-\eta_t g_t
                  \end{aligned}
                  \]
                </div>
                <p class="pipe-operational">Operational meaning: the updater adapts to recent flow, but stress fixtures do not constrain the step.</p>
              </figcaption>
            </figure>

            <div class="mechanism-concrete">
              <p class="mechanism-concrete-title">Concrete fixture view</p>
              <div class="anchor-board" role="img" aria-label="Anchor fixtures stored but inactive">
                <article class="anchor-card">
                  <p>Liquidity freeze</p>
                  <span>spread shock</span>
                </article>
                <article class="anchor-card">
                  <p>Gap-open day</p>
                  <span>open jump</span>
                </article>
                <article class="anchor-card">
                  <p>Correlation break</p>
                  <span>cross-asset drift</span>
                </article>
                <article class="anchor-card">
                  <p>Volatility cluster</p>
                  <span>persistent high vol</span>
                </article>
              </div>
              <p class="mechanism-concrete-note">Anchors exist, but the step ignores them. In production this is equivalent to trading on recent flow alone.</p>
            </div>
          </article>

          <article class="mechanism-card">
            <header class="mechanism-head">
              <p class="method-tag">B · Prior literature</p>
              <h3>Replay-Regularized Update</h3>
              <p class="mechanism-intuition">Each update mixes live drift with anchor replay. Retention improves, but the mixed step can still move outside a strict risk budget.</p>
            </header>

            <figure class="pipeline-figure" aria-label="Replay strategy pipeline">
              <svg class="pipeline-svg" viewBox="0 0 1240 282" role="img" aria-label="Replay update pipeline">
                <defs>
                  <marker id="arrow-replay" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                    <path d="M0,0 L10,5 L0,10 z" fill="#2f3d50"></path>
                  </marker>
                  <marker id="arc-replay" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                    <path d="M0,0 L10,5 L0,10 z" fill="#7b6346"></path>
                  </marker>
                </defs>

                <rect class="stage-box role-data" x="32" y="86" width="206" height="122" rx="10"></rect>
                <rect class="stage-box role-core" x="272" y="86" width="206" height="122" rx="10"></rect>
                <rect class="stage-box role-memory" x="512" y="86" width="206" height="122" rx="10"></rect>
                <rect class="stage-box role-update" x="752" y="86" width="206" height="122" rx="10"></rect>
                <rect class="stage-box role-decision" x="992" y="86" width="206" height="122" rx="10"></rect>

                <line class="flow-arrow" x1="238" y1="147" x2="272" y2="147" marker-end="url(#arrow-replay)"></line>
                <line class="flow-arrow" x1="478" y1="147" x2="512" y2="147" marker-end="url(#arrow-replay)"></line>
                <line class="flow-arrow" x1="718" y1="147" x2="752" y2="147" marker-end="url(#arrow-replay)"></line>
                <line class="flow-arrow" x1="958" y1="147" x2="992" y2="147" marker-end="url(#arrow-replay)"></line>
                <path class="flow-arc" d="M615 208 C 660 252, 805 252, 850 208" marker-end="url(#arc-replay)"></path>
                <text class="arc-label" x="676" y="258">anchor replay path</text>

                <text class="stage-cap" x="50" y="108">STREAM</text>
                <text class="stage-title" x="50" y="136">LLM market batch</text>
                <text class="stage-sub" x="50" y="158">tokens + returns x_t</text>

                <text class="stage-cap" x="290" y="108">FROZEN</text>
                <text class="stage-title" x="290" y="136">Transformer backbone</text>
                <text class="stage-sub" x="290" y="158">encoder + optimizer fixed</text>

                <text class="stage-cap" x="530" y="108">MEMORY</text>
                <text class="stage-title" x="530" y="136">Anchor set A_t</text>
                <text class="stage-sub" x="530" y="158">replayed each update</text>

                <text class="stage-cap" x="770" y="108">UPDATE</text>
                <text class="stage-title" x="770" y="136">Replay-mixed step</text>
                <text class="stage-sub" x="770" y="158">drift + anchor gradient</text>

                <text class="stage-cap" x="1010" y="108">DECISION</text>
                <text class="stage-title" x="1010" y="136">Portfolio optimizer</text>
                <text class="stage-sub" x="1010" y="158">emits weights w_t</text>
              </svg>

              <figcaption class="pipeline-formula">
                <p class="pipe-origin prior">Prior work</p>
                <div class="pipe-math">
                  \[
                  \begin{aligned}
                  g_t&=g_{d,t}+\beta_t g_{a,t},\\
                  \theta_{t+1}&=\theta_t-\eta_t g_t
                  \end{aligned}
                  \]
                </div>
                <p class="pipe-operational">Operational meaning: replay protects stress memory, but the mixed step can still exceed live risk bounds.</p>
              </figcaption>
            </figure>

            <div class="mechanism-concrete">
              <p class="mechanism-concrete-title">Anchor fixture board</p>
              <div class="anchor-board" role="img" aria-label="Anchor fixtures replayed in each update">
                <article class="anchor-card active">
                  <p>Liquidity freeze</p>
                  <span>funding stress</span>
                </article>
                <article class="anchor-card active">
                  <p>Gap-open day</p>
                  <span>overnight jump</span>
                </article>
                <article class="anchor-card active">
                  <p>Macro shock</p>
                  <span>policy surprise</span>
                </article>
                <article class="anchor-card active">
                  <p>Regime break</p>
                  <span>beta inversion</span>
                </article>
              </div>
              <p class="mechanism-concrete-note">Fixtures are replayed before every decision step, so stress memory actively shapes the update.</p>
            </div>
          </article>

          <article class="mechanism-card">
            <header class="mechanism-head">
              <p class="method-tag proposed">C · Proposed here</p>
              <h3>Replay + Projection Gate</h3>
              <p class="mechanism-intuition">The drift step is clipped to the feasible region before replay is added. The model keeps adapting, but the update stays inside the risk budget.</p>
            </header>

            <figure class="pipeline-figure" aria-label="Hybrid replay projection strategy pipeline">
              <svg class="pipeline-svg" viewBox="0 0 1240 282" role="img" aria-label="Hybrid update pipeline">
                <defs>
                  <marker id="arrow-hybrid" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                    <path d="M0,0 L10,5 L0,10 z" fill="#2f3d50"></path>
                  </marker>
                  <marker id="arc-hybrid" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                    <path d="M0,0 L10,5 L0,10 z" fill="#7b6346"></path>
                  </marker>
                </defs>

                <rect class="stage-box role-data" x="32" y="86" width="206" height="122" rx="10"></rect>
                <rect class="stage-box role-core" x="272" y="86" width="206" height="122" rx="10"></rect>
                <rect class="stage-box role-memory" x="512" y="86" width="206" height="122" rx="10"></rect>
                <rect class="stage-box role-update proposed" x="752" y="86" width="206" height="122" rx="10"></rect>
                <rect class="stage-box role-decision" x="992" y="86" width="206" height="122" rx="10"></rect>

                <line class="flow-arrow" x1="238" y1="147" x2="272" y2="147" marker-end="url(#arrow-hybrid)"></line>
                <line class="flow-arrow" x1="478" y1="147" x2="512" y2="147" marker-end="url(#arrow-hybrid)"></line>
                <line class="flow-arrow" x1="718" y1="147" x2="752" y2="147" marker-end="url(#arrow-hybrid)"></line>
                <line class="flow-arrow" x1="958" y1="147" x2="992" y2="147" marker-end="url(#arrow-hybrid)"></line>
                <path class="flow-arc" d="M615 208 C 660 252, 805 252, 850 208" marker-end="url(#arc-hybrid)"></path>
                <text class="arc-label" x="662" y="258">anchor replay path</text>

                <text class="stage-cap" x="50" y="108">STREAM</text>
                <text class="stage-title" x="50" y="136">LLM market batch</text>
                <text class="stage-sub" x="50" y="158">tokens + returns x_t</text>

                <text class="stage-cap" x="290" y="108">FROZEN</text>
                <text class="stage-title" x="290" y="136">Transformer backbone</text>
                <text class="stage-sub" x="290" y="158">encoder + optimizer fixed</text>

                <text class="stage-cap" x="530" y="108">MEMORY</text>
                <text class="stage-title" x="530" y="136">Anchor set A_t</text>
                <text class="stage-sub" x="530" y="158">replayed each update</text>

                <text class="stage-cap" x="770" y="108">UPDATE</text>
                <text class="stage-title" x="770" y="136">Projected mixed step</text>
                <text class="stage-sub" x="770" y="158">projected + replay mix</text>

                <text class="stage-cap" x="1010" y="108">DECISION</text>
                <text class="stage-title" x="1010" y="136">Portfolio optimizer</text>
                <text class="stage-sub" x="1010" y="158">emits weights w_t</text>
              </svg>

              <figcaption class="pipeline-formula">
                <p class="pipe-origin proposed">Proposed here</p>
                <div class="pipe-math">
                  \[
                  \begin{aligned}
                  g_t&=\Pi_{\mathcal{H}_t}(g_{d,t})+\beta_t g_{a,t},\\
                  \theta_{t+1}&=\theta_t-\eta_t g_t
                  \end{aligned}
                  \]
                </div>
                <p class="pipe-operational">Operational meaning: the step keeps replay memory and clips drift to the feasible risk region before execution.</p>
              </figcaption>
            </figure>

            <div class="mechanism-concrete projection-concrete">
              <p class="mechanism-concrete-title">Concrete projection view</p>
              <p class="projection-intuition">The raw learning step may imply an inadmissible trade. Projection keeps the step as close as possible to the proposal while enforcing the live risk budget.</p>

              <div class="projection-stage">
                <figure class="projection-figure">
                  <svg class="projection-diagram" viewBox="0 0 540 270" role="img" aria-label="Risk-budget constrained update projection">
                    <defs>
                      <marker id="proj-raw-arrow" markerWidth="9" markerHeight="9" refX="8" refY="4.5" orient="auto">
                        <path d="M0,0 L9,4.5 L0,9 z" fill="#b64834"></path>
                      </marker>
                      <marker id="proj-safe-arrow" markerWidth="9" markerHeight="9" refX="8" refY="4.5" orient="auto">
                        <path d="M0,0 L9,4.5 L0,9 z" fill="#1f3249"></path>
                      </marker>
                    </defs>

                    <rect x="0" y="0" width="540" height="270" fill="#ffffff"></rect>
                    <line x1="74" y1="220" x2="466" y2="220" stroke="#8f9ba9" stroke-width="1.6"></line>
                    <line x1="74" y1="220" x2="74" y2="42" stroke="#8f9ba9" stroke-width="1.6"></line>
                    <text x="470" y="239" font-size="12" fill="#5f6c7d">market beta</text>
                    <text x="35" y="48" font-size="12" fill="#5f6c7d" transform="rotate(-90 35 48)">value beta</text>

                    <polygon points="196,54 468,54 468,220 292,220" fill="#edf5ef" stroke="#587662" stroke-width="1.8"></polygon>
                    <line x1="196" y1="54" x2="292" y2="220" stroke="#587662" stroke-width="1.6" stroke-dasharray="6 5"></line>
                    <text x="322" y="75" font-size="12" fill="#4f6b57">feasible risk region</text>

                    <circle cx="126" cy="194" r="4.2" fill="#111827"></circle>
                    <text x="94" y="214" font-size="11" fill="#4a5565">current</text>
                    <line x1="126" y1="194" x2="392" y2="84" stroke="#b64834" stroke-width="2.8" marker-end="url(#proj-raw-arrow)"></line>
                    <line x1="126" y1="194" x2="292" y2="164" stroke="#1f3249" stroke-width="2.8" marker-end="url(#proj-safe-arrow)"></line>
                    <line x1="292" y1="164" x2="392" y2="84" stroke="#8f9daf" stroke-width="1.7" stroke-dasharray="4 5"></line>

                    <text x="398" y="82" font-size="12" fill="#b64834">raw update</text>
                    <text x="299" y="161" font-size="12" fill="#1f3249">projected update</text>
                    <text x="299" y="181" font-size="11.5" fill="#677487">nearest feasible correction</text>
                  </svg>
                </figure>

                <aside class="projection-key">
                  <h4>Mechanism key</h4>
                  <p><span>Raw step</span>unconstrained update from drift signal.</p>
                  <p><span>Budget</span>feasible exposure region set by risk limits.</p>
                  <p><span>Projection</span>nearest admissible update used for trading.</p>
                </aside>
              </div>

              <div class="projection-math-block">
                <p class="projection-origin">Proposed here</p>
                <div class="projection-math">
                  \[
                  \begin{aligned}
                  g_{\mathrm{proj}}&=\arg\min_g\lVert g-g_{\mathrm{raw}}\rVert_2^2\\
                  \text{s.t. }&\langle g,a_t\rangle \ge 0
                  \end{aligned}
                  \]
                </div>
                <p class="projection-operational">Operational meaning: learning is not rejected; the update is clipped to the closest direction that stays inside the live risk budget.</p>
              </div>
            </div>
          </article>
        </div>
      </section>

      <section class="section" id="workspace" aria-label="Interactive validation workspace">
        <h2>2. Deployment Decision Dashboard</h2>
        <p class="section-note">Treat this as a release gate. Each chart answers one deployment question before promotion.</p>

        <div class="metric-primer" aria-label="Metric primer">
          <article><strong>Portfolio value</strong><span>Capital path after costs.</span></article>
          <article><strong>Drawdown</strong><span>Peak-to-trough loss.</span></article>
          <article><strong>Turnover</strong><span>Weight change per step.</span></article>
          <article><strong>Regime Sharpe</strong><span>Risk-adjusted return per regime.</span></article>
        </div>

        <div class="experiment-layout">
          <aside class="control-panel">
            <article class="protocol-board">
              <h3>Modes</h3>
              <div class="preset-row mode-row">
                <button id="apply-quick" data-preset="quick_check" class="btn btn-ghost" type="button">Quick</button>
                <button id="apply-proposal" data-preset="proposal_like" class="btn btn-ghost" type="button">Default</button>
                <button id="apply-stress" data-preset="stress_heavy" class="btn btn-ghost" type="button">Stress+</button>
              </div>
              <p id="mode-readout" class="mode-readout"></p>
            </article>

            <div class="control-stack">
              <article class="focus-panel" aria-label="Strategy focus selector">
                <h3>Strategy</h3>
                <div class="focus-grid">
                  <button id="focus-all" data-focus="all" class="focus-btn active" type="button">All</button>
                  <button id="focus-naive" data-focus="naive" class="focus-btn" type="button">Naive</button>
                  <button id="focus-anchor" data-focus="anchor" class="focus-btn" type="button">Replay</button>
                  <button id="focus-proj" data-focus="anchor_proj" class="focus-btn" type="button">Hybrid</button>
                </div>
              </article>

              <article class="component-panel" aria-label="Constraint toggle interface">
                <h3>Constraint</h3>
                <label class="switch-row" for="toggle-anchor">
                  <span>Anchor fixtures</span>
                  <input id="toggle-anchor" type="checkbox" checked />
                </label>
                <label class="switch-row" for="toggle-projection">
                  <span>Projection gate</span>
                  <input id="toggle-projection" type="checkbox" checked />
                </label>
              </article>

              <details class="advanced-panel">
                <summary>Advanced knobs</summary>
                <form id="config-form" class="knob-grid">
                  <label>
                    Anchor weight
                    <input name="anchorBeta" type="number" step="0.01" />
                  </label>
                  <label>
                    Stress frequency
                    <input name="pStress" type="number" step="0.01" />
                  </label>
                  <label>
                    Update steps
                    <input name="steps" type="number" step="1" />
                  </label>
                  <label>
                    Seed
                    <input name="seed" type="number" step="1" />
                  </label>
                </form>
              </details>

              <div class="action-row">
                <button id="run-demo" class="btn btn-primary" type="button">Run Demo</button>
                <button id="reset-form" class="btn btn-ghost" type="button">Reset</button>
              </div>
            </div>

            <div class="run-status">
              <p id="status-line">Ready.</p>
              <div class="progress-track"><div id="progress-fill"></div></div>
            </div>
          </aside>

          <div class="results-panel">
            <article id="decision-card" class="decision-card"></article>

            <div id="impact-kpis" class="kpi-row"></div>

            <div class="plot-stack">
              <article class="chart-card">
                <h3>Q1. Portfolio Value Through Regimes</h3>
                <p class="plot-caption">Same path, same costs. Compare stress windows first, then terminal value.</p>
                <canvas id="pnl-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="pnl-reading"></p>
              </article>

              <article class="chart-card">
                <h3>Q2. Drawdown and Recovery</h3>
                <p class="plot-caption">Depth is loss from peak. Recovery is time back to peak.</p>
                <canvas id="drawdown-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="drawdown-reading"></p>
              </article>

              <article class="chart-card">
                <h3>Q3. Allocation vs Turnover</h3>
                <p class="plot-caption">Top: risky sleeve path. Bottom: turnover response on the same regimes.</p>
                <div id="allocation-legend" class="plot-legend" aria-label="Allocation strategy legend"></div>
                <p class="plot-legend-note">Color identifies strategy. Solid path = allocation, dotted path = turnover.</p>
                <canvas id="allocation-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="allocation-reading"></p>
              </article>

              <article class="chart-card">
                <h3>Q4. Regime Sharpe</h3>
                <p class="plot-caption">Annualized Sharpe by regime. This isolates where risk-adjusted return is earned.</p>
                <canvas id="regime-risk-chart" class="chart-canvas"></canvas>
                <p class="chart-reading" id="regime-risk-reading"></p>
              </article>

              <article class="chart-card chart-card-wide">
                <h3>Q5. Portfolio Policy View</h3>
                <p class="plot-caption">Calm vs stress risky sleeve per strategy. Lower stress sleeve indicates tighter risk compression.</p>
                <canvas id="portfolio-state-chart" class="chart-canvas chart-canvas-short"></canvas>
                <p class="chart-reading" id="portfolio-state-reading"></p>
              </article>
            </div>
          </div>
        </div>
      </section>

      <section class="section" id="takeaway-section">
        <h2>3. Deploy Path</h2>
        <p class="section-note">Deploy as a four-stage gate. The updater is promoted only when retention, drawdown, and execution stability remain inside release limits on the same market path.</p>

        <div class="deploy-path">
          <figure class="deploy-flow" aria-label="End-to-end deployment flow">
            <article class="deploy-node">
              <p class="deploy-step">Step 1</p>
              <h3>Updater candidate</h3>
              <p>Freeze backbone and optimizer. Swap only the updater.</p>
            </article>
            <div class="deploy-arrow">→</div>
            <article class="deploy-node">
              <p class="deploy-step">Step 2</p>
              <h3>Shadow replay run</h3>
              <p>Run drift plus anchors on the identical path, costs, and regimes.</p>
            </article>
            <div class="deploy-arrow">→</div>
            <article class="deploy-node proposed">
              <p class="deploy-step">Step 3</p>
              <h3>Release gate</h3>
              <p>Check retention, drawdown, turnover, and regime Sharpe together.</p>
            </article>
            <div class="deploy-arrow">→</div>
            <article class="deploy-node">
              <p class="deploy-step">Step 4</p>
              <h3>Paper then live</h3>
              <p>Paper trade first, then staged live rollout if ordering remains stable.</p>
            </article>
          </figure>

          <p class="deploy-gate-title">Release gates</p>
          <div class="deploy-gates" aria-label="Deployment gate checklist">
            <article>
              <h4>Promotion rule</h4>
              <p class="gate-pass"><strong>Pass:</strong> hybrid leads score and drawdown lift stays positive.</p>
              <p class="gate-fail"><strong>Fail:</strong> hold release and keep replay-only updater active.</p>
            </article>
            <article>
              <h4>Safety check</h4>
              <p class="gate-pass"><strong>Pass:</strong> stress retention and stress Sharpe stay above replay across seeds.</p>
              <p class="gate-fail"><strong>Fail:</strong> rerun with tighter projection and re-evaluate.</p>
            </article>
            <article>
              <h4>Rollback rule</h4>
              <p class="gate-pass"><strong>Pass:</strong> turnover and drawdown remain inside release band.</p>
              <p class="gate-fail"><strong>Fail:</strong> revert to last approved updater within one cycle.</p>
            </article>
          </div>

          <p class="deploy-outcome">Implementation takeaway: this process turns model updates into a controlled release workflow, not a one-shot backtest decision.</p>
        </div>

        <article id="takeaway" class="takeaway"></article>
      </section>
    </main>

    <footer class="footer">
      <div class="shell footer-inner">
        <a href="#top" class="inline-link">Back to top</a>
      </div>
    </footer>

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>
    <script>
      window.addEventListener("load", () => {
        if (!window.renderMathInElement) {
          return;
        }
        window.renderMathInElement(document.body, {
          delimiters: [
            { left: "\\[", right: "\\]", display: true },
            { left: "\\(", right: "\\)", display: false },
          ],
          throwOnError: false,
          strict: "ignore",
        });
      });
    </script>
    <script type="module" src="./src/main.js"></script>
  </body>
</html>
