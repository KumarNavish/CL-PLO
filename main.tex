% !TEX program = pdflatex
\documentclass[10pt,twocolumn]{article}

% ---------- Layout ----------
\usepackage[margin=0.70in,top=0.68in,bottom=0.72in]{geometry}
\setlength{\columnsep}{0.22in}
\setlength{\parindent}{0pt}
\setlength{\parskip}{3.5pt}
\usepackage{microtype}

% ---------- Color / boxes / lists ----------
\usepackage{xcolor}
\usepackage[most]{tcolorbox}
\usepackage{enumitem}
\usepackage{cuted} % full-width blocks in two-column layout
\usepackage{placeins} % provides FloatBarrier

\setlist[itemize]{leftmargin=*,topsep=2pt,itemsep=1pt,parsep=0pt}
\setlist[enumerate]{leftmargin=*,topsep=2pt,itemsep=1pt,parsep=0pt}

% ---------- Math ----------
\usepackage{amsmath,amssymb}
\usepackage{mathtools}

% ---------- Figures / tables ----------
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{caption}
\captionsetup{font=small,labelfont=bf}

% ---------- TikZ (kept for one small schematic only) ----------
\usepackage{tikz}
\usetikzlibrary{arrows.meta,positioning}

% ---------- Citations ----------
\usepackage[numbers,sort&compress]{natbib}
\setlength{\bibsep}{1pt}

% ---------- Links ----------
\usepackage[hidelinks]{hyperref}
\usepackage{url}

% ---------- Tighten whitespace ----------
\setlength{\abovedisplayskip}{4pt}
\setlength{\belowdisplayskip}{4pt}
\setlength{\abovedisplayshortskip}{3pt}
\setlength{\belowdisplayshortskip}{3pt}
\setlength{\textfloatsep}{7pt}
\setlength{\floatsep}{6pt}
\setlength{\intextsep}{7pt}

% ---------- Macros ----------
\newcommand{\RR}{\mathbb{R}}
\newcommand{\ip}[2]{\left\langle #1,#2\right\rangle}
\newcommand{\norm}[1]{\left\lVert #1\right\rVert}
\newcommand{\cM}{\mathcal{M}}
\newcommand{\cW}{\mathcal{W}}
\newcommand{\lead}[1]{\textbf{#1}\;}

% ---------- Visual system ----------
\definecolor{Ink}{RGB}{20,23,26}
\definecolor{Soft}{RGB}{245,247,250}
\definecolor{Edge}{RGB}{210,218,228}
\definecolor{Accent}{RGB}{40,80,170}
\definecolor{Mute}{RGB}{95,105,118}

\tcbset{
  colback=Soft,
  colframe=Edge,
  boxrule=0.6pt,
  arc=2pt,
  left=6pt,right=6pt,top=5pt,bottom=5pt
}

\newtcolorbox{callout}[1]{
  enhanced,
  title=\textbf{#1},
  coltitle=Ink,
  fonttitle=\small,
  boxed title style={colback=Soft,colframe=Edge,boxrule=0.6pt,arc=2pt},
}

% ---------- TikZ styles ----------
\tikzset{
  blk/.style={draw,rounded corners,align=center,inner sep=3.2pt,minimum height=1.55em,fill=Soft},
  arr/.style={-{Latex[length=2.4mm,width=1.8mm]},line width=0.85pt},
}

\title{Constraint-Aligned PEFT for Continual Transformer Signal Updating in Portfolio Optimization\\
\large Compressed proposal + executed validation experiment (figures included)}
\author{}
\date{}

\begin{document}
\maketitle
\vspace{-1.05em}

% Auto-generated by validation_experiment.py
\input{figs/metrics.tex}

\begin{strip}
\begin{callout}{Decision + evidence (scan in 30 seconds)}
\lead{Problem.} Online portfolio systems fail under drift for the same reason continual LLM updates fail: \emph{silent regression} on rarely-triggered but risk-critical contexts. The remedy is identical: \emph{define invariants, constrain updates, gate deployment}.\citep{lihoi2014ops,mahdavi2012online}

\lead{Mechanism contract (what you build).}
\begin{itemize}
  \item \textbf{Frozen backbone + PEFT:} update only a small LoRA/adapter subspace for auditable, reversible online adaptation.\citep{hu2022lora}
  \item \textbf{Anchor suite $\cM_t$:} a bounded set of stress/edge contexts (market + text) with cached \emph{reference outputs} (distillation anchors).
  \item \textbf{Constrained step:} project the drift-gradient so it does not worsen anchor losses (GEM/A-GEM in PEFT space; PEGP lens).\citep{chaudhry2019agem,qiao2024pegp}
  \item \textbf{Deterministic guardrails:} risk/turnover/compliance are enforced in the optimizer layer, independent of model updates.\citep{boyd2017mpt,rockafellar2000cvar}
\end{itemize}

\vspace{2pt}
\centering
\includegraphics[width=0.98\textwidth]{figs/validation_wide.pdf}
\vspace{-2pt}

{\small\textbf{Fig. 1 (executed).} \emph{Left:} drift-fit vs stress-anchor regression after updating on a drift regime. \emph{Right:} equity curves on a drift+stress stream. \textbf{Validated claim:} projection+anchoring reduces stress regression (\,\StressMSENaive\,$\rightarrow$\,\StressMSEProj\,) while keeping drift-fit tight, and improves tail behavior in a rebalancing loop (max drawdown \MDDNaive\,$\rightarrow$\,\MDDProj\,).}
\end{callout}
\end{strip}
\vspace{-0.25em}

\section*{1.\;Formulation (shared principles)}
\lead{Separation of concerns.} Let a transformer/LLM signal model $f_\theta$ output forecasts $(\hat\mu_t,\hat\Sigma_t)$ from market features $x_t$ and (optionally) text $z_t$. A deterministic optimizer maps forecasts to trades, enforcing feasibility regardless of $\theta$. This makes risk invariants unit-testable and the update surface auditable.\citep{boyd2017mpt}

\vspace{-2pt}
\begin{equation}
\label{eq:portfolio}
\begin{aligned}
 w_t \in \arg\min_{w\in\cW}\;& -\hat\mu_t^\top w + \gamma\, w^\top \hat\Sigma_t w + \lambda_{\mathrm{tc}}\,\mathrm{TC}(w,w_{t-1})\\
 \text{s.t. }\;& c_k(w)\le 0,\; \mathrm{CVaR}_{\alpha}(w)\le \tau_{\alpha},\; \mathrm{Drawdown}(w)\le \tau_{\mathrm{dd}}.
\end{aligned}
\end{equation}

\lead{Key bridge.} In continual LLM tuning, “retention” is behavioral. In portfolio ops, retention is explicit: stress-suite behavior, constraint satisfaction, and tail-risk bounds. Those become the anchor suite $\cM_t$ and the regression constraints.

\clearpage

\section*{2.\;Update rule (method-separating adaptation loop)}
\lead{What updates online.} Only PEFT parameters $\phi$ (e.g., LoRA matrices) update on the current slice $D_t$; the backbone is frozen.

\lead{What is stored.} A bounded anchor suite $\cM_t$ plus cached reference outputs from the last deployed checkpoint $\theta^{\mathrm{ref}}$ (distillation anchors). No requirement to store raw historic data if outputs suffice for invariants.

\lead{Constrained PEFT step.} Compute a drift gradient $g_{\mathrm{new}}$ (fit current regime) and an anchor gradient $g_{\mathrm{anc}}$ (do not regress on $\cM_t$). Then update by taking the closest feasible direction in PEFT space:
\vspace{-6pt}
\begin{equation}
\label{eq:proj}
 v_t \in \arg\min_{v\in\RR^d}\;\tfrac12\norm{v-g_{\mathrm{new}}}^2\quad\text{s.t.}\quad \ip{v}{g_{\mathrm{anc}}}\ge -\epsilon.
\end{equation}
\vspace{-2pt}
\lead{Interpretation.} Eq.\,\ref{eq:proj} is GEM/A-GEM-style gradient projection, executed inside a small trainable subspace (PEGP view). $\epsilon$ is an explicit, deployable knob for allowed stress-regression per update.

\section*{3.\;Production contract (enablement, not exposition)}
\begin{callout}{Operational checklist (minimum viable deployment)}
\begin{itemize}
  \item \textbf{Update cadence:} on a fixed schedule (daily/weekly) or on detected drift (KL/output drift, factor decay, volatility regime).
  \item \textbf{Promotion gate:} recent backtest \emph{and} stress-suite regression bound \emph{and} constraint-violation bound \emph{and} output-drift bound (anchors).
  \item \textbf{Rollback triggers:} constraint breach, tail-risk regression, realized slippage/turnover spikes, stress-suite alarm, or unexplained attribution shifts.
  \item \textbf{Audit artifacts:} anchor-suite hash, LoRA delta checksum, gate metrics, and the exact optimizer configuration for the deployed snapshot.
\end{itemize}
\end{callout}

\lead{Reproduce (end-to-end).}
\begin{itemize}
  \item Generate figures and LaTeX macros: \texttt{python validation\_experiment.py}
  \item Compile PDF: \texttt{pdflatex main.tex} (run twice for references)
\end{itemize}

\FloatBarrier
\vspace{-0.9em}
{\tiny
\begin{thebibliography}{99}\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}
\bibitem{lihoi2014ops} B.~Li and S.~C.~H. Hoi. Online portfolio selection: a survey. \emph{ACM Computing Surveys}, 2014.
\bibitem{mahdavi2012online} M.~Mahdavi, R.~Jin, and T.~Yang. Online optimization with long term constraints. In \emph{NeurIPS}, 2012.
% (Removed for compression)
\bibitem{boyd2017mpt} S.~Boyd et~al. Multi-period trading via convex optimization. \emph{Foundations and Trends in Optimization}, 2017.
\bibitem{rockafellar2000cvar} R.~T. Rockafellar and S.~Uryasev. Optimization of conditional value-at-risk. \emph{Journal of Risk}, 2000.
% (Removed for compression)
\bibitem{hu2022lora} E.~J. Hu et~al. LoRA: low-rank adaptation of large language models. In \emph{ICLR}, 2022.
\bibitem{chaudhry2019agem} A.~Chaudhry et~al. Efficient lifelong learning with A-GEM. In \emph{ICLR}, 2019.
\bibitem{qiao2024pegp} J.~Qiao et~al. Gradient projection for continual parameter-efficient tuning. arXiv:2405.13383, 2024.
% (Removed for compression)
\end{thebibliography}
}
\vspace{-0.5em}

\end{document}
